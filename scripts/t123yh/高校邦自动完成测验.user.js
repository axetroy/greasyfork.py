// ==UserScript==
// @name         高校邦自动完成测验
// @namespace    http://tampermonkey.net/
// @version      0.2
// @description  适用于 大学生职业生涯规划，商务礼仪，安全教育，心理健康
// @author       BUAA1873
// @match        https://buaa.class.gaoxiaobang.com/class/27479/quiz*
// @match        https://buaa.class.gaoxiaobang.com/class/27477/quiz*
// @match        https://buaa.class.gaoxiaobang.com/class/27473/quiz*
// @match        https://buaa.class.gaoxiaobang.com/class/27472/quiz*
// @grant        none
// ==/UserScript==
(function() {
    'use strict';

    let shie = 0000;

    function executeUntilSuccess(func, trySpan) {
        let xs = function() {
            let succ = true;
            try {
                func();
            } catch (ex) {
                succ = false;
            }
            if (!succ) {
                setTimeout(xs, trySpan);
            }
        };
        setTimeout(xs, 0);
    }

    if (shie != 1873) {
        alert("使用前，请看看代码，证明你士个谔人");
        return;
    }

    executeUntilSuccess(function() {
        if (typeof jQuery == 'undefined') {
            throw "No jQuery";
        }
        console.log("Running");
        if (/^https:\/\/.*\.class\.gaoxiaobang\.com\/class\/.*\/quiz(?:\?.+)?$/.test(window.location.href)) {
            executeUntilSuccess(function() {
                let result = jQuery('#quizList');
                if (result.length == 0) {
                    throw "No quiz element";
                }
                setTimeout(function() {
                    jQuery(".quiz-join").first().click();
                }, 1000);
            })
        } else if (/^https:\/\/.*\.class\.gaoxiaobang\.com\/class\/.*\/quiz\/\d+\/submission\/\d+$/.test(window.location.href)) {
            executeUntilSuccess(function() {
                jQuery("#quiz_back_id").click();
            });
        } else if (/^https:\/\/.*\.class\.gaoxiaobang\.com\/class\/.*\/quiz\/\d+$/.test(window.location.href)) {
            const answerList = {"68876": [259166, 259167, 259168], "68877": [259173], "68878": [259174, 259175, 259176, 259177], "68879": [259178, 259179, 259180, 259181], "68882": [259190, 259191], "68883": [259197], "68884": [259198, 259199, 259200, 259201], "68892": [259225, 259226, 259227], "68893": [259228, 259229], "68894": [259232, 259233, 259234, 259235], "68895": [259236, 259237, 259239], "68896": [259240], "68897": [259244], "68898": [259248, 259249, 259250], "68899": [259252, 259253], "68900": [259257], "68905": [259273], "68906": [259274, 259277], "68907": [259278, 259280], "68908": [259282, 259283, 259284, 259285], "68921": [259332], "68922": [259337], "68923": [259338, 259339, 259340, 259341], "68924": [259343], "151358": [581449, 581451], "151359": [581454, 581455, 581456, 581457], "151351": [581420], "68925": [259346, 259347, 259348], "68926": [259350, 259351, 259353], "41615": [158462, 158463, 158464, 158465], "41616": [158469], "41617": [158472], "41618": [158477], "41619": [158478, 158479, 158480, 158481], "41458": [157835], "41459": [157841], "41460": [157845], "41461": [157849], "41462": [157850], "41463": [157856], "41464": [157861], "41465": [157865], "41466": [157868], "41467": [157873], "41468": [157877], "41469": [157881], "41470": [157885], "41471": [157888], "41472": [157891], "41473": [157896], "41474": [157900], "41475": [157904], "41476": [157907], "41477": [157913], "41478": [157916], "41479": [157920], "41480": [157925], "41481": [157928], "41482": [157933], "41483": [157935], "41484": [157939], "41485": [157945], "41486": [157947], "41487": [157953], "41488": [157956], "41489": [157958, 157959, 157960, 157961], "41490": [157964], "41491": [157969], "54429": [205752], "54430": [205756], "41344": [157378], "41345": [157383], "41346": [157388], "41347": [157392], "41348": [157395], "41349": [157401], "41350": [157402], "41351": [157409], "41352": [157413], "41353": [157416], "41354": [157421], "41355": [157425], "41356": [157429], "41357": [157431, 157433], "41358": [157434, 157435, 157436, 157437], "41359": [157441], "41300": [157205], "41301": [157207], "41302": [157213], "41303": [157214], "41304": [157221], "41305": [157225], "41306": [157229], "41307": [157230], "41308": [157237], "41309": [157241], "41310": [157242], "41311": [157248], "41312": [157252], "41313": [157256], "41314": [157259], "41315": [157262], "41316": [157269], "41317": [157273], "41318": [157276], "41319": [157281], "41322": [157293], "41323": [157297], "41324": [157298, 157299, 157300, 157301], "41325": [157302], "41326": [157308], "41327": [157311], "54431": [205760], "54432": [205764], "41372": [157493], "41373": [157494], "41374": [157498, 157499, 157500, 157501], "41375": [157505], "41376": [157506], "41377": [157511], "41378": [157517], "41379": [157521], "41380": [157523], "41381": [157529], "41382": [157533], "41383": [157534, 157535, 157536, 157537], "41384": [157538, 157539, 157540, 157541], "41385": [157542, 157543, 157544], "41386": [157547], "41387": [157551], "41388": [157557], "41389": [157560], "41390": [157562], "41391": [157569], "41392": [157570, 157571, 157572, 157573], "41393": [157576], "41394": [157578, 157579, 157580, 157581], "41395": [157582], "41398": [157597], "41399": [157599], "41400": [157605], "41401": [157608], "41402": [157613], "41403": [157614], "41404": [157618], "41405": [157622], "41406": [157628], "41407": [157630, 157632], "41408": [157635], "41409": [157641], "41418": [157677], "41419": [157678, 157679, 157680, 157681], "54433": [205768], "54434": [205772], "65703": [247022, 247023, 247024], "65706": [247036], "65707": [247038, 247039, 247040], "65709": [247046, 247047, 247048, 247049], "65710": [247051, 247052], "65711": [247055], "65712": [247058], "65713": [247065], "65714": [247067], "65715": [247072], "65716": [247074, 247076, 247077], "65717": [247078, 247079, 247081], "65718": [247082, 247083, 247085], "65719": [247087, 247089], "65720": [247090], "65721": [247097], "65722": [247098, 247099, 247101], "65723": [247104], "65724": [247106, 247107, 247108, 247109], "65725": [247111, 247112], "65726": [247114, 247117], "65727": [247119], "65728": [247122, 247124, 247125], "65729": [247127, 247128, 247129], "65730": [247131], "65731": [247134], "65732": [247138, 247139, 247140], "65733": [247142, 247143], "65734": [247146], "65735": [247150, 247151, 247152, 247153], "65736": [247154, 247155, 247156, 247157], "65737": [247158, 247159, 247160], "65738": [247162], "65739": [247168], "65744": [247186], "65751": [247212, 247213, 247214], "65758": [247236, 247237], "65765": [247262], "65772": [247293], "65789": [247350, 247351, 247353], "65791": [247356, 247357, 247358, 247359], "65792": [247360], "65794": [247368, 247369, 247370, 247371], "65795": [247375], "65796": [247379], "65797": [247381, 247382, 247383], "65798": [247385], "65800": [247393], "65801": [247396], "65802": [247400], "65803": [247403], "65804": [247406, 247409], "65805": [247412], "65806": [247415], "65807": [247419], "65808": [247424], "65809": [247427, 247428, 247429], "65810": [247431, 247433], "65811": [247434, 247435, 247437], "65812": [247438, 247440, 247441], "110584": [412003], "110583": [411998], "110581": [411990, 411991], "110579": [411982, 411983, 411984, 411985], "110577": [411978], "110575": [411968, 411969, 411970], "110573": [411962], "110570": [411948, 411949, 411950], "110568": [411940, 411941, 411942, 411943], "127968": [476455, 476456, 476457, 476458], "127971": [476467, 476468, 476469, 476470, 476471], "127972": [476472, 476473, 476475], "127973": [476479], "127974": [476482], "127975": [476485], "127976": [476488, 476489], "127977": [476491, 476492, 476493, 476494, 476495], "127978": [476498], "127979": [476500, 476501, 476502], "127980": [476504, 476505, 476506, 476507], "127981": [476510], "127982": [476512, 476514], "127983": [476519], "127984": [476520, 476522], "127985": [476524, 476525, 476526, 476527], "127986": [476528], "127987": [476530, 476531, 476532], "135467": [522335, 522336, 522337, 522338], "135468": [522339, 522340, 522341, 522342], "135469": [522343, 522344, 522345, 522346], "135470": [522347, 522348, 522349, 522350], "135471": [522352], "135472": [522358], "135473": [522359, 522360, 522361, 522362], "135474": [522363, 522364, 522365, 522366], "135475": [522367, 522368, 522369, 522370], "135476": [522373], "135464": [522323, 522324, 522325, 522326], "135465": [522327, 522328, 522329, 522330], "135466": [522331, 522332, 522333], "143492": [552050, 552051, 552052, 552053], "143493": [552055], "143255": [551214], "143256": [551216, 551217, 551218], "143257": [551220], "143258": [551223], "143259": [551224, 551226, 551227], "143260": [551228], "145802": [560987, 560988, 560989], "145803": [560992, 560993, 560994], "145804": [560997], "143261": [551230, 551231], "143262": [551234], "143263": [551236], "143264": [551238], "143265": [551241], "143266": [551242], "143267": [551244], "143268": [551246, 551247, 551248, 551249], "143269": [551251], "143270": [551254], "143271": [551255], "143272": [551257, 551258, 551259, 551260], "143273": [551261], "143274": [551263], "143287": [551298], "145805": [561000, 561001, 561002], "145806": [561003, 561004, 561005, 561006], "145808": [561012, 561013, 561014], "145807": [561007, 561008, 561009], "143288": [551299, 551300, 551301, 551302], "143289": [551303, 551304, 551305, 551306], "143290": [551307, 551309], "145809": [561015, 561016, 561017, 561018], "145810": [561019, 561022], "145811": [561023, 561024, 561025, 561026], "143275": [551265], "143276": [551267], "143277": [551270], "143278": [551271], "143279": [551273], "143280": [551275], "143281": [551279, 551280], "143282": [551281], "143283": [551284], "143284": [551285, 551286, 551287, 551288], "143285": [551289, 551290], "143286": [551294], "143494": [552060], "143495": [552062], "145812": [561027, 561028, 561029, 561030], "145813": [561031, 561032, 561033, 561034], "145814": [561035, 561036, 561037, 561038], "143297": [551335, 551336], "143291": [551311, 551312, 551313, 551314], "143292": [551315, 551316, 551317, 551318], "143293": [551319, 551320, 551321, 551322], "143294": [551323, 551324, 551326], "143295": [551327, 551328, 551329, 551330], "143296": [551331, 551332, 551334], "143298": [551339], "143299": [551341], "143300": [551343, 551345, 551346], "143301": [551348], "143302": [551349], "145815": [561041], "145816": [561044, 561045, 561046], "145817": [561048], "143303": [551351, 551352, 551353], "143304": [551355], "143305": [551357], "143306": [551360], "143307": [551361], "143308": [551363], "143309": [551365, 551366, 551367, 551368], "143310": [551369, 551370], "143311": [551373, 551374], "143312": [551377, 551378, 551379, 551380], "143313": [551384], "143314": [551385, 551386, 551387, 551388], "143315": [551389, 551390, 551391, 551392], "143316": [551394], "143317": [551397], "143318": [551401, 551402, 551403, 551404], "143319": [551405, 551406, 551407, 551408], "143320": [551409, 551410], "143330": [551449, 551450, 551451], "143335": [551469, 551470, 551472], "143331": [551453, 551454, 551455], "143332": [551457, 551458, 551459, 551460], "143333": [551461, 551462, 551463], "143334": [551465, 551466, 551468], "143336": [551473, 551474, 551475, 551476], "143337": [551477, 551478, 551479], "143338": [551481, 551482, 551483], "143339": [551485, 551486, 551487, 551488], "143340": [551489], "143341": [551493, 551494, 551495], "143342": [551497]};

            executeUntilSuccess(function() {
                let result = jQuery('#quizPaper');
                if (result.length == 0) {
                    throw "No quiz element";
                }
                setTimeout(function() {
                    let success = true;
                    jQuery(".answer-wap").each(function() {
                        const questionId = jQuery(this).attr("question_id");
                        if (!(questionId in answerList)) {
                            success = false;
                        } else {
                            for (const ans of answerList[questionId]) {
                                jQuery(`i[answer_id='${ans}'`).click();
                            }
                        }
                    });
                    if (success) {
                        setTimeout(function() {
                            jQuery("#quizSubmit").click();
                            setTimeout(function() {
                                jQuery(".gxb-sure").click();
                            }, 200);
                        }, 1000);
                    } else {
                        alert("One or more answers are missing. Please disable the GXB script.");
                    }
                }, 500);
            })
        }
    });
})();