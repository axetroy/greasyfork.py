'use strict';// ==UserScript==
// @name          C&C:TA CnC-Eco
// @version       1.0.6
// @namespace     http://cnc-eco.herokuapp.com
// @homepage      http://cnc-eco.herokuapp.com
// @description   Sammelt Informationen ueber Basenausbau der Allianzmitglieder (basierend auf Skripte / Routinen von neobsen, JimBeamJD, KRS_L, F.D, und Dooki)
// @author        F.D, J.L.
// @include       http*://*.alliances.commandandconquer.com/*/index.aspx*
// @icon          https://cnc-eco.herokuapp.com/favicon.ico
// @copyright     2018, J.L.
// @grant         GM_log
// @grant         GM_setValue
// @grant         GM_getValue
// @grant         GM_registerMenuCommand
// @grant         GM_xmlhttpRequest
// @grant         GM_updatingEnabled
// @grant         unsafeWindow
// @license       CC BY-NC-SA 4.0 - http://creativecommons.org/licenses/by-nc-sa/4.0/
// ==/UserScript==
(function(){var t=document.createElement('script'),n=function(){function t(){var t=Math.floor,C=Math.abs,I=Math.round,O={};Array.isarray||(Array.isarray=function(t){return!!(t instanceof Array)}),Object.isobj||(Object.isobj=function(t){return!!(t instanceof Object&&!0!=t instanceof Array)}),JSON.isjson||(JSON.isjson=function(t){try{return JSON.parse(t),'parse'}catch(n){try{return JSON.stringify(t),'stringify'}catch(t){return!1}}}),qx.Class.define('CncEcomain',{type:'singleton',extend:qx.core.Object,construct:function(){this.mainMenuContent=new qx.ui.menu.Menu,this.mainMenuButton=new qx.ui.form.MenuButton('CncEco',null,this.mainMenuContent),this.mainMenuButton.set({width:70,appearance:'button-bar-right',toolTipText:'List of MemberStatsCommands'}),this.mainMenuButton.addListener('execute',function(){this.mainMenuContent.open()},this);for(var t=qx.core.Init.getApplication().getUIItem(ClientLib.Data.Missions.PATH.BAR_MENU),n=t.getChildren()[1].getChildren(),o=n.length-1;0<=o;o--)'function'==typeof n[o].setAppearance&&'button-bar-right'==n[o].getAppearance()&&n[o].setAppearance('button-bar-center');t.getChildren()[1].add(this.mainMenuButton),t.getChildren()[0].setScale(!0),t.getChildren()[0].setWidth(834)},members:{mainMenuContent:null,mainMenuButton:null,poiwindow:null,poiInfoWindow:null,AddMainMenu:function(t,n,o){null===t?_('CncEco.AddSubMenu: name empty'):null===n?_('CncEco.AddMainMenu: command empty'):(null===o?(t=new qx.ui.menu.Button(t),t.addListener('execute',n)):(o=new qx.ui.command.Command(o),o.addListener('execute',n,this),t=new qx.ui.menu.Button(t),t.setCommand(o)),this.mainMenuContent.add(t))},AddSubMainMenu:function(t){if(null===t)_('Mest.AddSubMainMenu: name empty');else{var n=new qx.ui.menu.Menu;return t=new qx.ui.menu.Button(t,null,null,n),this.mainMenuContent.add(t),n}},AddSubMenu:function(t,n,o,r){if(null===n)_('CncEco.AddSubMenu: name empty');else if(null===o)_('CncEco.AddSubMenu: command empty');else if(null===t)_('CncEco.AddSubMenu: subMenu empty');else{if(null!==r){var s=new qx.ui.command.Command(r);s.addListener('execute',o,this),r=new qx.ui.menu.Button(n),r.setCommand(s)}else r=new qx.ui.menu.Button(n),r.addListener('execute',o);return t.add(r),t=new qx.ui.menu.Menu,new qx.ui.menu.Button(n,null,null,t),t}},initialize:function(){try{var t=ClientLib.Data.MainData.GetInstance();t.get_Player().get_Name(),t.get_Server().get_WorldId(),t.get_Alliance().get_Id(),addEventListener('keyup',this.onKey,!1),_('init done'),CncEcomain.getInstance().doAtLogin(),CncEcomain.getInstance().doAfter(),Array.isArray||(Array.isArray=function(t){return'[object Array]'===Object.prototype.toString.call(t)}),Object.isObj||(Object.isObj=function(t){return'[object Object]'===Object.prototype.toString.call(t)})}catch(t){_(t)}},onKey:function(t){console.log(t)},doMenu:function(){var t=CncEcomain.getInstance(),n=t.AddSubMainMenu('MainOptions');t.AddSubMenu(n,'open cnc-eco.de',function(){CncEcomain.getInstance().openurl()}),t.AddSubMenu(n,'send BaseData',function(){CncEcomain.getInstance().doAfter()},'Alt+y'),!0===ClientLib.Data.MainData.GetInstance().get_Alliance().get_IsAdmin()&&(n=t.AddSubMainMenu('State of War'),t.AddSubMenu(n,'set State of War',function(){CncEcomain.getInstance().remoteRequest('stateofwar')},'Alt+p'),t.AddSubMenu(n,'unset State of War',function(){CncEcomain.getInstance().remoteRequest('unsetstateofwar')},'Alt+o'))},doAtLogin:function(){this.checkWar(),this.doMenu(),this.isPoiMinister()},doAfter:function(){CncEcomain.getInstance().checkVersion(),CncEcomain.getInstance().PlayerUpdate()},checkWar:function(){CncEcomain.getInstance().getIsWar()},checkVersion:function(){CncEcomain.getInstance().remoteRequest('version')},openurl:function(){CncEcomain.getInstance().remoteRequest('new_check')},askOtherButton:function(){CncEcomain.getInstance().remoteRequest('button_check')},setSubstitution:function(t,n){CncEcomain.getInstance().substitutionXhr('set',n,t)},removeSubstitution:function(t,n){CncEcomain.getInstance().substitutionXhr('unset',t,n)},poiInfo:function(){CncEcomain.getInstance().getWindow().open(),this.getWindow().push('Create PoiInfo\nplease wait\n\n'),CncEcomain.getInstance().getPoiInfo()},isPoiMinister:function(){_('check if poiminister'),CncEcomain.getInstance().remoteRequest('poiminister')},substitutionXhr:function(t,o,r){var s=ClientLib.Data.MainData.GetInstance().get_Server().get_WorldId(),d=ClientLib.Net.CommunicationManager.GetInstance().get_InstanceId(),l=new qx.bom.request.Xhr;'set'==t&&(l.onload=function(){if('0'==l.responseText&&_('WarSubstitution is set!'),'1'==l.responseText&&_('WarSubstitution is Error!'),'2'==l.responseText){l.abort(),_('substitution ist nicht richtig gesetzt');var t=ClientLib.Data.MainData.GetInstance().get_PlayerSubstitution().getOutgoing();t.n!==r&&(_('Substitution to '+t.n+' delet'),t='{"session":"'+d+'","id":"'+t.i+'","pid":"'+t.p1+'"}',CncEcomain.getInstance().removeSubstitution(t,r))}'3'==l.responseText&&_('WarSubstitution Account nicht auf dieser Welt!'),'4'==l.responseText&&_('WarSubstitution kann nicht auf eigenen account gesetzt werden!')},l.open('POST','/'+s+'/Presentation/Service.svc/ajaxEndpoint/SubstitutionCreateReq'),l.setRequestHeader('Content-Type','application/json'),l.send(o)),'unset'==t&&(l.onload=function(){if('0'==l.responseText){var t='{"session":"'+ClientLib.Net.CommunicationManager.GetInstance().get_InstanceId()+'","name":"'+r+'"}';CncEcomain.getInstance().setSubstitution(r,t)}},l.open('POST','/'+s+'/Presentation/Service.svc/ajaxEndpoint/SubstitutionCancelReq'),l.setRequestHeader('Content-Type','application/json'),l.send(o))},getIsWar:function(){_('Check if is War'),'true'===P.get_IsSubstituteLogin()?_('Player is substitutionLogin'):(_('Player is not substitutionLogin'),CncEcomain.getInstance().remoteRequest('war'))},PlayerUpdate:function(){var t=ClientLib.Data.MainData.GetInstance();t.get_Player().get_Name();var n=t.get_Alliance(),o=t.get_Player().get_Id();t.get_Server(),ClientLib.Net.CommunicationManager.GetInstance().get_InstanceId(),n.get_OwnedPOIs(),ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('GetPublicPlayerInfo',{id:o},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,r),null)},remoteRequest:function(t,o){var r=ClientLib.Data.MainData.GetInstance(),s=r.get_Player().get_Name(),d=r.get_Alliance(),l=r.get_Player().get_Id(),n=r.get_Server(),g=ClientLib.Net.CommunicationManager.GetInstance().get_InstanceId(),c=d.get_OwnedPOIs(),u=new qx.io.remote.Request('https://cnc-eco.herokuapp.com/api/v1/ingameData','POST','text/html');u.setTimeout(3e3),u.setProhibitCaching(!1),u.setRequestHeader('Content-Type','text/html'),u.setTimeout('3600000'),u.setResponseType('text/html'),u._ontimeout=function(){u.abort(),_('req abort')},'version'==t&&(_('version check'),u.setData('version'),u.setParameter('version','4.7.5'),u.addListener('completed',function(t){'version'===t.getContent()?(_('UPDATE is vorhanden'),CncEcomain.getInstance().UpdateWindow()):_('Kein Script Update')}),u.send()),'update'==t&&(u.setData('UPDATE'),u.setParameter('update','1'),console.log('PlayerInfoData= null ______________________'),CncEcomain.getInstance().Playerinfo(u,o),u.addListener('completed',function(t){_('PlayerDataUpdate'),'UPDATED'===t.getContent()&&_('PlayerData Up To Date')})),'new_check'==t&&(u.setData('new_check'),u.setParameter('new_check',s),u.addListener('completed',function(t){''===t.getContent()?(_('new Account:: '+t.getContent()),CncEcomain.getInstance().winOpen('',s)):(_('NOT new :: '+t.getContent()),CncEcomain.getInstance().winOpen('',''))}),u.send()),'war'==t&&(u.setData('WAR'),u.setParameter('name',s),u.setParameter('alli',d.get_Id()),u.setParameter('world',n.get_WorldId()),u.addListener('completed',function(t){var n='{"session":"'+g+'","name":"'+t.getContent()+'"}';if(''!==t.getContent()&&s!==t.getContent()&&!0!==ClientLib.Data.MainData.GetInstance().get_Player().get_IsSubstituteLogin()){var o=ClientLib.Data.MainData.GetInstance().get_PlayerSubstitution().getOutgoing();null===o?CncEcomain.getInstance().CncEcoUvWindow(t.getContent(),n):(_(o),o.n!==t.getContent()&&CncEcomain.getInstance().CncEcoUvWindow(t.getContent(),n))}else _('No War')}),u.send()),'stateofwar'==t&&(u.setData('stateofwar'),u.setParameter('stateofwar',s),u.setParameter('token',l),u.setParameter('alli',d.get_Id()),u.setParameter('world',n.get_WorldId()),u.addListener('completed',function(t){'stateofwar'===t.getContent()?(_('State of War is set'),CncEcomain.getInstance().stateofwarwin(s,'set')):_('State of War ERROR :: '+t.getContent())}),r=ClientLib.Data.MainData.GetInstance().get_Alliance().get_IsAdmin(),!0===r?u.send():_('State of War ERROR :: You are no admin!')),'unsetstateofwar'==t&&(u.setData('unsetstateofwar'),u.setParameter('unsetstateofwar',s),u.setParameter('token',l),u.setParameter('alli',d.get_Id()),u.setParameter('world',n.get_WorldId()),u.addListener('completed',function(t){'unsetstateofwar'===t.getContent()?(_('State of War is unset'),CncEcomain.getInstance().stateofwarwin(s,'unset')):_('State of War ERROR :: '+t.getContent())}),r=ClientLib.Data.MainData.GetInstance().get_Alliance().get_IsAdmin(),!0===r?u.send():_('State of War ERROR :: You are no admin!')),'poiminister'==t&&(u.setData('poiminister'),u.setParameter('poiminister',s),u.setParameter('token',l),u.setParameter('alli',d.get_Id()),u.setParameter('world',n.get_WorldId()),u.addListener('completed',function(t){t.getContent()===s?'0'<c.length?(_('you are PoiMinister'),CncEcomain.getInstance().AddMainMenu('PoiInfo',function(){CncEcomain.getInstance().poiInfo()},'Alt+x')):_('you are PoiMinister but alli have 0 Poi\'s '):_('you are not PoiMinister :: '+t.getContent())}),u.send())},Playerinfo:function(t,r){qx.core.Init.getApplication().getBackgroundArea().closeCityInfo();var s=ClientLib.Data.MainData.GetInstance(),l=s.get_Alliance().get_MemberDataAsArray(),c=s.get_Server().get_Name().trim(),_=s.get_Server().get_WorldId(),p=s.get_Cities(),m=p.get_CurrentOwnCity().get_AllianceName(),p=p.get_CurrentOwnCity().get_AllianceId();for(t.setFormField('version','4.7.5'),t.setFormField('worldId',_),t.setFormField('serverName',c),t.setFormField('allianceId',p),t.setFormField('allianceName',m),t.setFormField('count',l.length),c=0;c<l.length;c++)_=l[c].Id,m=l[c].Name,p=l[c].RoleName,t.setFormField('playerId'+c,_),t.setFormField('name'+c,m),t.setFormField('ro'+c,p);for(c in l=s.get_Cities(),_=l.get_CurrentOwnCity().get_PlayerId(),t.setFormField('currentplayerId',_),_=ClientLib.Data.MainData.GetInstance().get_Player().accountId,t.setFormField('accountId',_),_=ClientLib.Data.MainData.GetInstance().get_Alliance().get_FirstLeaders().l,m=ClientLib.Data.MainData.GetInstance().get_Alliance().get_SecondLeaders().l,t.setFormField('cic',_),t.setFormField('sc',m),_=l.get_CurrentOwnCity().get_PlayerName(),t.setFormField('currentplayerName',_),_=r.c.length,t.setFormField('basecount',_),t.setFormField('fraction',r.f),t.setFormField('basekills',r.bd),t.setFormField('pvekills',r.bde),t.setFormField('pvpkills',r.bd-r.bde),t.setFormField('points',r.p),t.setFormField('rank',r.r),t.setFormField('hascode',r.hchc),t.setFormField('maxcp',P.GetCommandPointMaxStorage()),t.setFormField('actcp',I(P.GetCommandPointCount())),t.setFormField('funds',s.get_Inventory().get_PlayerFunds()),t.setFormField('schirme',I(P.GetSupplyPointCount())),t.setFormField('RPoints',P.get_ResearchPoints()),t.setFormField('CreditsCount',I(P.GetCreditsCount())),s=ClientLib.Data.MainData.GetInstance().get_Player(),m=s.get_Faction(),m=ClientLib.Base.Tech.GetTechIdFromTechNameAndFaction(ClientLib.Base.ETechName.Research_BaseFound,m),m=s.get_PlayerResearch().GetResearchItemFomMdbId(m).get_NextLevelInfo_Obj(),s=[],m.rr)0<m.rr[c].t&&(s[m.rr[c].t]=m.rr[c].c);for(c=s[ClientLib.Base.EResourceType.Gold],s=s[ClientLib.Base.EResourceType.ResearchPoints],m=P.get_Credits(),m=(m.Delta+m.ExtraBonusDelta)*ClientLib.Data.MainData.GetInstance().get_Time().get_StepsPerHour(),c=(c-P.GetCreditsCount())/m,t.setFormField('timeTOmcv',I(3600*c)),t.setFormField('rpNeeded',s),c=0;c<_;c++){var m=l.GetCity(r.c[c].i),s=[];s.Id=r.c[c].i,s.Na=m.get_Name(),s.Po=r.c[c].p,s.Lvl=m.get_LvlBase().toFixed(2),s.Off=m.get_LvlOffense().toFixed(2),s.Def=m.get_LvlDefense().toFixed(2),s.PosX=r.c[c].x,s.PosY=r.c[c].y,p=m.get_CityUnitsData(),s.repInf=0<s.Off?p.GetRepairTimeFromEUnitGroup(ClientLib.Data.EUnitGroup.Infantry,!1):0,s.repVeh=0<s.Off?p.GetRepairTimeFromEUnitGroup(ClientLib.Data.EUnitGroup.Vehicle,!1):0,s.repAir=0<s.Off?p.GetRepairTimeFromEUnitGroup(ClientLib.Data.EUnitGroup.Aircraft,!1):0,s.maxRep=0<s.Off?m.GetResourceMaxStorage(ClientLib.Base.EResourceType.RepairChargeInf):0,s.availRep=0<s.Off?ClientLib.Base.Resource.GetResourceCount(m.get_RepairOffenseResources().get_RepairChargeOffense()):0;var h=m.get_SupportWeapon();s.supWp=null===h?'':h.n,h=m.get_SupportData(),s.SL=null===h?0:h.get_Level(),p=m.get_CityBuildingsData(),h=p.GetUniqueBuildingByTechName(ClientLib.Base.ETechName.Construction_Yard),s.CY=null===h?0:h.get_CurrentLevel(),h=p.GetUniqueBuildingByTechName(ClientLib.Base.ETechName.Defense_Facility),s.DF=null===h?0:h.get_CurrentLevel(),h=p.GetUniqueBuildingByTechName(ClientLib.Base.ETechName.Defense_HQ),s.DHQ=null===h?0:h.get_CurrentLevel(),s.PP=I(m.GetResourceGrowPerHour(ClientLib.Base.EResourceType.Power,!1,!1)),s.PBP=I(m.GetResourceBonusGrowPerHour(ClientLib.Base.EResourceType.Power)),s.PAB=ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Power),s.CP=I(ClientLib.Base.Resource.GetResourceGrowPerHour(m.get_CityCreditsProduction(),!1)),s.CBP=I(ClientLib.Base.Resource.GetResourceBonusGrowPerHour(m.get_CityCreditsProduction(),!1)),s.Tall=I(m.GetResourceGrowPerHour(ClientLib.Base.EResourceType.Tiberium,!1,!1)+m.GetResourceBonusGrowPerHour(ClientLib.Base.EResourceType.Tiberium)+ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Tiberium)),s.Call=I(m.GetResourceGrowPerHour(ClientLib.Base.EResourceType.Crystal,!1,!1)+m.GetResourceBonusGrowPerHour(ClientLib.Base.EResourceType.Crystal)+ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Crystal)),s.PPall=s.PP+s.PBP+s.PAB,s.CPall=s.CP+s.CBP,t.setFormField('basename'+c,s.Na),t.setFormField('baseid'+c,s.Id),t.setFormField('punkte'+c,s.Po),t.setFormField('level'+c,s.Lvl),t.setFormField('off'+c,s.Off),t.setFormField('def'+c,s.Def),t.setFormField('repinf'+c,s.repInf),t.setFormField('repveh'+c,s.repVeh),t.setFormField('repair'+c,s.repAir),t.setFormField('repmax'+c,s.maxRep),t.setFormField('availrep'+c,s.availRep),t.setFormField('suptype'+c,s.supWp),t.setFormField('suplvl'+c,s.SL),t.setFormField('cylvl'+c,s.CY),t.setFormField('dflvl'+c,s.DF),t.setFormField('dfhqlvl'+c,s.DHQ),t.setFormField('power'+c,s.PPall),t.setFormField('tib'+c,s.Tall),t.setFormField('cris'+c,s.Call),t.setFormField('cash'+c,s.CPall),t.setFormField('x'+c,s.PosX),t.setFormField('y'+c,s.PosY),o(s.Id,c,t)}console.log('de funk werd aufgruafa'),t.send()},stateofwarwin:function(t,o){var r=new qx.ui.window.Window('Alliance on war');if('set'==o)var s='You "'+t+'" have set State of War',l='Set State of War';'unset'==o&&(s='You "'+t+'" have delet State of War',l='UnSet State of War'),r.set({caption:l,icon:'webfrontend/ui/common/icon_moral_alert_red.png',layout:new qx.ui.layout.HBox(4),width:250,height:75,contentPaddingTop:0,contentPaddingBottom:6,contentPaddingRight:6,contentPaddingLeft:6,showMaximize:!1,showMinimize:!1,allowMaximize:!1,allowMinimize:!1,resizable:!1,visibility:'visible',textColor:'#bfbfbf'}),r.setPadding(10),r.setLayout(new qx.ui.layout.VBox(10)),l=new qx.ui.container.Composite(new qx.ui.layout.VBox(4).set({alignX:'left'})),l.add(new qx.ui.basic.Label(s)),s=new qx.ui.container.Composite(new qx.ui.layout.VBox(1).set({alignX:'center'}));var c=new qx.ui.form.Button('close');c.set({toolTipText:'close',width:70,height:20,maxWidth:200,maxHeight:32,center:!0,rich:!0}),s.add(c),c.addListener('execute',function(){r.close()},this),r.add(l),r.add(s),r.center(),r.open()},CncEcoUvWindow:function(t,o){var r=new qx.ui.window.Window('Alliance on war'),s='Your commander has declared war status!|It was sent a substitution to:|'+t;r.set({caption:'Alliance on war',icon:'webfrontend/ui/common/icon_moral_alert_red.png',layout:new qx.ui.layout.HBox(4),width:300,height:150,contentPaddingTop:0,contentPaddingBottom:6,contentPaddingRight:6,contentPaddingLeft:6,showMaximize:!1,showMinimize:!1,allowMaximize:!1,allowMinimize:!1,resizable:!1,visibility:'visible',textColor:'#bfbfbf'}),r.setPadding(10),r.setLayout(new qx.ui.layout.VBox(10));var l=new qx.ui.container.Composite(new qx.ui.layout.VBox(4).set({alignX:'left'})),c=new qx.ui.container.Composite(new qx.ui.layout.VBox(1).set({alignX:'center'})),n=new qx.ui.form.Button('send Substitution'),u=new qx.ui.form.Button('abort');for(n.set({toolTipText:'send Substitution',width:120,height:20,maxWidth:200,maxHeight:32,center:!0,rich:!0}),u.set({toolTipText:'dont send substitution',width:120,height:20,maxWidth:200,maxHeight:32,center:!0,rich:!0}),c.add(n),c.add(u),n.addListener('execute',function(){r.close(),CncEcomain.getInstance().substitutionXhr('set',o,t)},this),u.addListener('execute',function(){r.close()},this),s=s.split('|'),i=0;'3'>i;i++)l.add(new qx.ui.basic.Label(s[i]));r.add(l),r.add(c),r.center(),r.open()},UpdateWindow:function(){var t=new qx.ui.window.Window('MemberStats Update!');t.set({caption:'MemberStats Update!',icon:'webfrontend/ui/common/icon_moral_alert_red.png',layout:new qx.ui.layout.HBox(4),width:450,height:170,contentPaddingTop:0,contentPaddingBottom:6,contentPaddingRight:6,contentPaddingLeft:6,showMaximize:!1,showMinimize:!1,allowMaximize:!1,allowMinimize:!1,resizable:!0,visibility:'excluded',textColor:'#bfbfbf'}),t.setPadding(10),t.setLayout(new qx.ui.layout.VBox(10));var n=new qx.ui.container.Composite(new qx.ui.layout.VBox(2).set({alignX:'left'})),o=new qx.ui.basic.Label('MemberStatsScript "4.7.5" is to old');n.add(o),o=new qx.ui.basic.Label('Please disable/deinstall the old script and get new version'),n.add(o),o=new qx.ui.basic.Label(''),n.add(o),o=new qx.ui.basic.Label('Click button below to open link to get new version'),n.add(o);var o=new qx.ui.container.Composite(new qx.ui.layout.VBox(2).set({alignX:'right'})),r=new qx.ui.form.Button('Get new Script');o.add(r),r.addListener('execute',function(){t.close(),qx.core.Init.getApplication().showExternal('https://www.member-stats.de/?link=new_version','.member-stats')},this),t.add(n),t.add(o),t.center(),t.open()},getPoiInfo:function(){function t(t,n){try{var o=n.c;for(var r in p={},o){var s=o[r];p[r]={},p[r].x=s.x,p[r].y=s.y,p[r].n=s.n,m.push([p[r].n,p[r].x,p[r].y,n.n])}}catch(t){_('onPlayerInfo: ',t)}}h=[],m=[];var o=ClientLib.Data.MainData.GetInstance(),r=o.get_Alliance().get_OwnedPOIs(),s=r.length,c=this.getWindow();c.push('search all Pois from Alliance\n');for(var g=0;g<s;g++){if(null!==r[g]&&'undefined'!==r[g]){var f=phe.cnc.gui.util.Text.getPoiInfosByType(r[g].t).name,y=r[g].t,b=r[g].l,u=r[g].i,C=ClientLib.Base.PointOfInterestTypes.GetScoreByLevel(r[g].l),l=phe.cnc.gui.util.Numbers.formatCoordinates(r[g].x,r[g].y);h.push([u,f,b,C,r[g].x,r[g].y,l,y])}if(g+1==s)for(_('AlliancePois scanned'),c.push('AlliancePois scanned\n'),f=[],f=o.get_Alliance().get_MemberDataAsArray(),c.push('search all Playerbases\n'),y=0;y<f.length;y++)d=f[y].Name,ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('GetPublicPlayerInfoByName',{name:d},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,t),!0),y+1===f.length&&(_('save all Playerbases'),c.push('all Playerbases saved\n'),CncEcomain.getInstance().getBasesOnPoi())}},getBasesOnPoi:function(){_('scan if Playerbase is in range of a AlliancePoi');var t=this.getWindow();t.push('scan if Playerbase is in range of a AlliancePoi\n'),S=[],ClientLib.Data.MainData.GetInstance().get_Alliance().get_MemberDataAsArray(),window.setTimeout(function(){for(var n=0;n<m.length;n++){for(var o=0;o<h.length;o++){var r=C(m[n][1]-h[o][4]),s=C(m[n][2]-h[o][5]);2<r||2<s||2==r&&2==s||S.push([h[o][0],h[o][1],h[o][2],h[o][3],h[o][6],m[n][0],m[n][3],h[o][4],h[o][5],h[o][7]])}n+1===m.length&&o===h.length&&(_('Scan complete'),t.push('Scan complete\n'),CncEcomain.getInstance().SendPoiInfo())}},2e3)},SendPoiInfo:function(){var t=this.getWindow();t.push('Preparing to Send PoiInfo to Memberstats.de\n'),_('Preparing to Send PoiInfo'),window.setTimeout(function(){function n(){o.addListener('completed',function(n){''===n.getContent()?_('hab nix bekommen '+n.getContent()):(_('hab was bekommen '+n.getContent()),t.push('complete Send PoiInfo to Memberstats.de\n'),'none'==CncEcomain.getInstance().getForumId()?CncEcomain.getInstance().CreatePoiForum(S):(n=CncEcomain.getInstance().getForumId(),CncEcomain.getInstance().PoiForum(S,n)))}),o.send()}var o=new qx.io.remote.Request('https://www.member-stats.de/poi/','POST','text/html');if(o.setProhibitCaching(!1),o.setRequestHeader('Content-Type','text/html'),o.setTimeout('3600000'),o.setResponseType('text/html'),null!==S){var r=ClientLib.Data.MainData.GetInstance(),s=r.get_Server().get_WorldId(),r=r.get_Alliance().get_Id();for(o.setFormField('worldId',s),o.setFormField('allianceId',r),o.setData('PoiData'),o.setParameter('version','4.7.5'),o.setFormField('count',S.length),s=0;s<S.length;s++)o.setFormField('id'+s,S[s][0]),o.setFormField('name'+s,S[s][1]),o.setFormField('level'+s,S[s][2]),o.setFormField('score'+s,S[s][3]),o.setFormField('coords'+s,S[s][4]),o.setFormField('playerBase'+s,S[s][5]),o.setFormField('player'+s,S[s][6]),o.setFormField('x'+s,S[s][7]),o.setFormField('y'+s,S[s][8]),o.setFormField('type'+s,S[s][9]),s+1===S.length&&(_('Send PoiInfo to https://www.member-stats.de'),window.setTimeout(n,1e3))}},2e3)},winOpen:function(t,o){var r=CncEcoScanner.Layout.window.getInstance(),s='https://www.member-stats.de';if(''!==o&&(s='https://www.member-stats.de/?link=new_account&account='+o),'layout'==o){var l=ClientLib.Data.MainData.GetInstance(),u=l.get_Player().get_Name();s='https://www.member-stats.de?link=layout&worldid='+l.get_Server().get_WorldId()}var l=qx.core.Init.getApplication(),n=new webfrontend.gui.CustomWindow(l.tr('tnf:external link')).set({resizable:!1,showClose:!1,showMaximize:!1,showMinimize:!1});n.setLayout(new qx.ui.layout.VBox(10)),n.addListenerOnce('resize',n.center,n),n.add(new qx.ui.basic.Label(l.tr('tnf:link will lead to an external page?')+'<br />'+l.tr('tnf:do you want to continue?')).set({rich:!0,maxWidth:360,wrap:!0,textColor:'white'})),t=new qx.ui.container.Composite(new qx.ui.layout.HBox(10).set({alignX:'right'}));var _=new webfrontend.ui.SoundButton(l.tr('tnf:no'));_.addListener('execute',function(){n.close(),'layout'==o&&(CncEcoScanner.getInstance().win.close(),!0!==r.active&&CncEcoScanner.Layout.window.getInstance().openWindow('CncEco Scan result'))},this),l=new webfrontend.ui.SoundButton(l.tr('tnf:yes')),l.addListener('execute',function(t){n.close(),'layout'==o&&(CncEcoScanner.getInstance().win.close(),!0!==r.active&&CncEcoScanner.Layout.window.getInstance().openWindow('CncEco Scan result')),t='<form name=\'LaunchForm\' id=\'LaunchForm\' action=\''+s+'\' method=\'POST\'>',t+='<input type=\'hidden\' name=\'dummy\' value=\'dummy\' />','layout'==o&&(t+='<input type=\'hidden\' name=\'name\' value=\''+u+'\' />'),t+='</form><script type=\'text/javascript\'>document.LaunchForm.submit();</script>';var d=window.open('','');d.document.write(t),d.document.close()},this),t.add(_),t.add(l),n.add(t),n.setModal(!0),n.open()},getForumId:function(t){t=ClientLib.Data.MainData.GetInstance().get_Forum().get_Forums();var n,o=t.c,r='none',s=1;for(n in t.d){if('CncEco PoiInfo'==t.d[n].Title)return r=t.d[n].Id;if('none'==r&&s===o&&s<=o)return r;s++}},SortAlliancePois:function(o,s){function c(t,n){!0===n&&0===d?(I.push('Post all AlliancePois to Forum\n'),d++):!0==n&&(0===y?y++:1==y?_('do something postInfoAll'):2<f&&_('postInfoAll do is was schiaf glafn '+f)),!0!==n&&I.push('ERROR: Post all AlliancePois to Forum\n'+n+'\n')}var I=CncEcomain.getInstance().getWindow();I.push('Try to insert a post to "List of Alliance Poi"\n'),_('forumid: '+o+' threadid: '+s);for(var d=0,b=[],P=[],x=[],S=[],u=[],p=[],l=[],O='',T=0;T<h.length;T++){var M=h[T][1],R=h[T][7],L=h[T][2],N=h[T][0],k=h[T][3],W=h[T][6],V=h[T][4],j=h[T][5];if(2===h[T][7]&&b.push([N,M,L,k,V,j,W,R]),3===h[T][7]&&P.push([N,M,L,k,V,j,W,R]),4===h[T][7]&&x.push([N,M,L,k,V,j,W,R]),5===h[T][7]&&S.push([N,M,L,k,V,j,W,R]),6===h[T][7]&&u.push([N,M,L,k,V,j,W,R]),7===h[T][7]&&p.push([N,M,L,k,V,j,W,R]),8===h[T][7]&&l.push([N,M,L,k,V,j,W,R]),T+1==h.length)for(j=V=W=k=N=L=R=M=0;j<=b.length;j++)if(0===j&&(O+='[b][u]Tiberium[/u][/b]\n'),j==b.length){for(var O=O+'\n',O=O+'\n',O=O+'[u]Tiberium TotalScore:[/u]\n',O=O+('[b]'+M+'[/b]\n'),O=O+'[hr]\n',H=0;H<=P.length;H++)if(0===H&&(O+='[b][u]Crystal[/u][/b]\n'),H==P.length){for(var O=O+'\n',O=O+'\n',O=O+'[u]Crystal TotalScore:[/u]\n',O=O+('[b]'+R+'[/b]\n'),O=O+'[hr]\n',U=0;U<=x.length;U++)if(0===U&&(O+='[b][u]Reactor[/u][/b]\n'),U==x.length){for(var O=O+'\n',O=O+'\n',O=O+'[u]Power TotalScore:[/u]\n',O=O+('[b]'+L+'[/b]\n'),O=O+'[hr]\n',q=0;q<=S.length;q++)if(0===q&&(O+='[b][u]Tungsten[/u][/b]\n'),q==S.length){for(var O=O+'\n',O=O+'\n',O=O+'[u]Tung TotalScore:[/u]\n',O=O+('[b]'+N+'[/b]\n'),O=O+'[hr]\n',X=0;X<=u.length;X++)if(0===X&&(O+='[b][u]Uranium[/u][/b]\n'),X==u.length){for(var O=O+'\n',O=O+'\n',O=O+'[u]Uran TotalScore:[/u]\n',O=O+('[b]'+k+'[/b]\n'),O=O+'[hr]\n',Z=0;Z<=p.length;Z++)if(0===Z&&(O+='[b][u]Aircraft[/u][/b]\n'),Z==p.length)for(var O=O+'\n',O=O+'\n',O=O+'[u]Air TotalScore:[/u]\n',O=O+('[b]'+W+'[/b]\n'),O=O+'[hr]\n',Y=0;Y<=l.length;Y++)0===Y&&(O+='[b][u]Resonator[/u][/b]\n'),Y==l.length?(O+='\n',O+='\n',O+='[u]Reso TotalScore:[/u]\n',O+='[b]'+V+'[/b]\n'):(O+='Level: '+l[Y][2]+' Score: '+l[Y][3]+' Coords: [coords]'+l[Y][6]+'[/coords]\n',V+=l[Y][3]);else O+='Level: '+p[Z][2]+' Score: '+p[Z][3]+' Coords: [coords]'+p[Z][6]+'[/coords]\n',W+=p[Z][3];}else O+='Level: '+u[X][2]+' Score: '+u[X][3]+' Coords: [coords]'+u[X][6]+'[/coords]\n',k+=u[X][3];}else O+='Level: '+S[q][2]+' Score: '+S[q][3]+' Coords: [coords]'+S[q][6]+'[/coords]\n',N+=S[q][3];}else O+='Level: '+x[U][2]+' Score: '+x[U][3]+' Coords: [coords]'+x[U][6]+'[/coords]\n',L+=x[U][3];}else O+='Level: '+P[H][2]+' Score: '+P[H][3]+' Coords: [coords]'+P[H][6]+'[/coords]\n',R+=P[H][3];}else O+='Level: '+b[j][2]+' Score: '+b[j][3]+' Coords: [coords]'+b[j][6]+'[/coords]\n',M+=b[j][3]}if(T==h.length)if(2999>=O.length)ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('CreateForumPost',{forumID:o,threadID:s,postMessage:O},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,c),!0),_('All Pois inserted to Forum');else for(T in b=O.split('[hr]\n'),b)ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('CreateForumPost',{forumID:o,threadID:s,postMessage:b[T]},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,c),!0),_('All Pois inserted to Forum')},SortWhoPois:function(o,s){function c(t,n){!0===n&&0===x?(O.push('Post "Who is at POI X" to Forum\n'),x++):!0==n&&(0===f?f++:1==f?(O.close(),_('do something postInfoWho')):1<f&&_('postInfoWho do is was schiaf glafn '+f)),!0!==n&&O.push('ERROR: Post "Who is at POI X" to Forum\n'+n+'\n')}var x=0;_('Try to insert a post to "Who is at POI X"');var O=CncEcomain.getInstance().getWindow();O.push('Try to insert a post to "Who is at POI X"\n');for(var g=[],b=[],T=[],R=[],u=[],p=[],l=[],r='',E=0,k=0,W=0,V=0,j=0,U=0,q=0,X=0;X<h.length;X++){for(var Z=h[X][0],B=h[X][1],F=h[X][2],G=h[X][3],H=h[X][4],N=h[X][5],Y=h[X][6],J=h[X][7],L=0;L<S.length;L++){var K=S[L][5],I=S[L][6];h[X][0]==S[L][0]&&(2==J&&('undefined'==typeof g[E]&&(g[E]=[]),g[E].push([Z,B,F,G,H,N,Y,J,K,I])),3==J&&('undefined'==typeof b[k]&&(b[k]=[]),b[k].push([Z,B,F,G,H,N,Y,J,K,I])),4==J&&('undefined'==typeof T[W]&&(T[W]=[]),T[W].push([Z,B,F,G,H,N,Y,J,K,I])),5==J&&('undefined'==typeof R[V]&&(R[V]=[]),R[V].push([Z,B,F,G,H,N,Y,J,K,I])),6==J&&('undefined'==typeof u[j]?(u[j]=[],u[j].push([Z,B,F,G,H,N,Y,J,K,I]),j++):u[j].push([Z,B,F,G,H,N,Y,J,K,I])),7==J&&('undefined'==typeof p[U]&&(p[U]=[]),p[U].push([Z,B,F,G,H,N,Y,J,K,I])),8==J&&('undefined'==typeof l[q]&&(l[q]=[]),l[q].push([Z,B,F,G,H,N,Y,J,K,I])))}'undefined'!=typeof g[E]&&E++,'undefined'!=typeof b[k]&&k++,'undefined'!=typeof T[W]&&W++,'undefined'!=typeof R[V]&&V++,'undefined'!=typeof u[j]&&j++,'undefined'!=typeof p[U]&&U++,'undefined'!=typeof l[q]&&q++}if(X==h.length){for(E=0;E<g.length;E++)for(0==E&&(r+='[b][u]Tiberium[/u][/b]\n'),k=0;k<g[E].length;k++)0==k&&(r+='Level: '+g[E][k][2]+' Score: '+g[E][k][3]+' Coords [coords]'+g[E][k][6]+'[/coords]\n'),r+='Player: [player]'+g[E][k][9]+'[/player] base: '+g[E][k][8]+'\n',k+1==g[E].length&&(r+='\n');for(k=0;k<b.length;k++)for(0==k&&(r+='[hr]\n[b][u]Crystal[/u][/b]\n'),W=0;W<b[k].length;W++)0==W&&(r+='Level: '+b[k][W][2]+' Score: '+b[k][W][3]+' Coords [coords]'+b[k][W][6]+'[/coords]\n'),r+='Player: [player]'+b[k][W][9]+'[/player] base: '+b[k][W][8]+'\n',W+1==b[k].length&&(r+='\n');for(W=0;W<T.length;W++)for(0==W&&(r+='[hr]\n[b][u]Reactor[/u][/b]\n'),V=0;V<T[W].length;V++)0==V&&(r+='Level: '+T[W][V][2]+' Score: '+T[W][V][3]+' Coords [coords]'+T[W][V][6]+'[/coords]\n'),r+='Player: [player]'+T[W][V][9]+'[/player] base: '+T[W][V][8]+'\n',V+1==T[W].length&&(r+='\n');for(V=0;V<R.length;V++)for(0==V&&(r+='[hr]\n[b][u]Tungsten[/u][/b]\n'),j=0;j<R[V].length;j++)0==j&&(r+='Level: '+R[V][j][2]+' Score: '+R[V][j][3]+' Coords [coords]'+R[V][j][6]+'[/coords]\n'),r+='Player: [player]'+R[V][j][9]+'[/player] base: '+R[V][j][8]+'\n',j+1==R[V].length&&(r+='\n');for(j=0;j<u.length;j++)for(0==j&&(r+='[hr]\n[b][u]Uranium[/u][/b]\n'),U=0;U<u[j].length;U++)0==U&&(r+='Level: '+u[j][U][2]+' Score: '+u[j][U][3]+' Coords [coords]'+u[j][U][6]+'[/coords]\n'),r+='Player: [player]'+u[j][U][9]+'[/player] base: '+u[j][U][8]+'\n',U+1==u[j].length&&(r+='\n');for(U=0;U<p.length;U++)for(0==U&&(r+='[hr]\n[b][u]Aircraft[/u][/b]\n'),q=0;q<p[U].length;q++)0==q&&(r+='Level: '+p[U][q][2]+' Score: '+p[U][q][3]+' Coords [coords]'+p[U][q][6]+'[/coords]\n'),r+='Player: [player]'+p[U][q][9]+'[/player] base: '+p[U][q][8]+'\n',q+1==p[U].length&&(r+='\n');for(q=0;q<l.length;q++)for(0==q&&(r+='[hr]\n[b][u]Resonator[/u][/b]\n'),X=0;X<l[q].length;X++)0===X&&(r+='Level: '+l[q][X][2]+' Score: '+l[q][X][3]+' Coords [coords]'+l[q][X][6]+'[/coords]\n'),r+='Player: [player]'+l[q][X][9]+'[/player] base: '+l[q][X][8]+'\n',X+1==l[q].length&&(r+='\n');if(E!=g.length||k!=b.length||W!=T.length||V!=R.length||j!=u.length||U!=p.length||q!=l.length)console.log('tib '+E+' '+g.length+' cris '+k+' '+b.length+' reaktor '+W+' '+T.length+' tung '+V+' '+R.length+' uran '+j+' '+u.length+' luft '+U+' '+p.length+' reso '+q+' '+l.length);else if(g=r.length,console.log(g),2999>=g)ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('CreateForumPost',{forumID:o,threadID:s,postMessage:r},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,c),!0)&&_('who Pois inserted to Forum');else{var P,r=r.split('[hr]\n');for(P in r)ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('CreateForumPost',{forumID:o,threadID:s,postMessage:r[P]},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,c),!0),_('who Pois inserted to Forum')}}},PoiForum:function(t,o){function r(t,n){!0===t&&'0'==n&&ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('GetForumThreads',{forumId:o,skip:0,take:10},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,s),!0)}function s(t,n){for(var s in console.log(n),n){var d=n[s].i;'List of Alliance Poi'==n[s].t&&0==u&&(CncEcomain.getInstance().SortAlliancePois(o,d),u=1),'Who is at POI X'==n[s].t&&0==g&&(CncEcomain.getInstance().SortWhoPois(o,d),g=1)}0==u?(l.push('Try to create Thread "List of Alliance Poi"\n'),ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('CreateForumThread',{forumID:o,threadTitle:'List of Alliance Poi',firstPostMessage:'.',subscribe:!0},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,r),!0)):0==g&&(l.push('Try to create Thread2 "Who is at POI X"\n'),ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('CreateForumThread',{forumID:o,threadTitle:'Who is at POI X',firstPostMessage:'.',subscribe:!0},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,r),!0))}ClientLib.Data.MainData.GetInstance().get_Forum().get_Forums();var l=this.getWindow(),u=0,g=0;ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('GetForumThreads',{forumId:o,skip:0,take:10},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,s),!0)},CreatePoiForum:function(t){if(!0===ClientLib.Data.MainData.GetInstance().get_Alliance().get_CanCreateForum()){var o=function(){d.push('Try to create Thread "List of Alliance Poi"\n');var o=CncEcomain.getInstance().getForumId(t),o='{"session":"'+c+'", "forumID":'+o+',"threadTitle":"List of Alliance Poi","subscribe":true,"firstPostMessage":"."}';u.onload=function(){'0'==u.responseText?(u.abort(),_('Thread erstellt!!!'),d.push('Thread "List of Alliance Poi" created!\n'),window.setTimeout(r,1e3)):_('ERROR: thread erstellen!')},u.open('POST','/'+n+'/Presentation/Service.svc/ajaxEndpoint/CreateForumThread'),u.setRequestHeader('Content-Type','application/json'),u.send(o)},r=function(){d.push('Try to create Thread2 "Who is at POI X"\n');var o=CncEcomain.getInstance().getForumId(t),o='{"session":"'+c+'", "forumID":'+o+',"threadTitle":"Who is at POI X","subscribe":true,"firstPostMessage":"."}';u.onload=function(){'0'==u.responseText?(u.abort(),_('Thread2 erstellt!!!'),d.push('Thread "Who is at POI X" created!\n'),window.setTimeout(s,1e3)):_('ERROR: Thread2 erstellen!')},u.open('POST','/'+n+'/Presentation/Service.svc/ajaxEndpoint/CreateForumThread'),u.setRequestHeader('Content-Type','application/json'),u.send(o)},s=function(){var n=CncEcomain.getInstance().getForumId(t);CncEcomain.getInstance().PoiForum(t,n)};_('CreatePoiForum');var d=this.getWindow();d.push('Try to create PoiForum\n');var n=ClientLib.Data.MainData.GetInstance().get_Server().get_WorldId(),c=ClientLib.Net.CommunicationManager.GetInstance().get_InstanceId(),u=new qx.bom.request.Xhr;u.onload=function(){'0'==u.responseText?(u.abort(),_('forum erstellt!!!'),d.push('created PoiForum\n'),window.setTimeout(o,1e3)):_('ERROR: forum erstellt!')};u.open('POST','/'+n+'/Presentation/Service.svc/ajaxEndpoint/CreateForum'),u.setRequestHeader('Content-Type','application/json'),u.send('{"session":"'+c+'", "sharedAlliance":null,"Title":"CncEco PoiInfo","Description":"List of AlliancePois"}')}else d.push('no rights to create PoiForum\n')},getWindow:function(){return null===this.poiwindow&&(this.poiwindow=new CncEcoreport.window,this.poiwindow.moveTo(window.innerWidth-150-this.poiwindow.getWidth()-200,40)),this.poiwindow},getPoiWindow:function(){return null===this.poiInfoWindow&&(this.poiInfowindow=new CncEcoreport.window,this.poiInfoWindow.center()),this.poiwindow},_Allisupport:function(){for(var t,o=ClientLib.Data.MainData.GetInstance().get_AllianceSupportState().get_Bases().d,r=Object.keys(o),s=r.length,l={},u=0,_=0,p=s;s--;)t=o[r[s]],l.hasOwnProperty(t.get_Type())||(l[t.get_Type()]=0),l[t.get_Type()]++,30<=t.get_Level()&&_++,u+=t.get_Level();for(u/=p,o=ClientLib.Data.MainData.GetInstance().get_Alliance().get_MemberData().d,l=0,r=Object.keys(o),s=r.length;s--;)t=o[r[s]],l+=t.Bases;r='Bases: '+l+' SupCount: '+p+'('+(100*(p/l)).toFixed(0)+'%) \xD8: '+u.toFixed(2)+' 30+: '+_+'('+(100*(_/l)).toFixed(0)+'%)',CncEcomain.getInstance().getWindow().push(r)}}}),qx.Class.define('CncEcoPlayerinfo',{type:'singleton',extend:qx.core.Object,members:{windowinterval:null,windowbevoreunload:null,get_info:function(){try{var t=ClientLib.Data.MainData.GetInstance();return P=t.get_Player(),P.get_Name(),P.get_AccountId(),u=t.get_Alliance(),t.get_Server().get_WorldId(),!0}catch(n){t={func:'get_info',class:'CncEco5main'},t.error=n,_(n),beta&&s(n,t)}},initialize:function(){try{return _('CncEcoPlayerinfo load'),_('CncEcoPlayerinfo load'),_('CncEcoPlayerinfo load'),_('CncEcoPlayerinfo load'),this.get_info()&&ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('GetPublicPlayerInfo',{id:playerId},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,this.Playerinfo),null),this.windowinterval=window.setInterval(function(){CncEcoPlayerinfo.getInstance().interval()},18e5),this.windowbevoreunload=window.addEventListener('beforeunload',function(){CncEcoPlayerinfo.getInstance().interval()}),!0}catch(n){var t={func:'ini',class:'CncEcoPlayerinfo'};t.error=n,_(n),beta&&s(n,t)}},interval:function(){try{if(Main.get_info())return ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand('GetPublicPlayerInfo',{id:playerId},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,this.Playerinfo),null),!0}catch(n){var t={func:'interval',class:'CncEcoPlayerinfo'};t.error=n,_(n),beta&&s(n,t)}},Playerinfo:function(l,c){try{var h={server:{}};if(h.server.serverid=worldId,h.server.serverName=MainData.get_Server().get_Name().trim(),0<c.a){h.alli={},h.alli.alliId=c.a,h.alli.alliName=c.an,h.alli.cic=u.get_FirstLeaders().l,h.alli.sc=u.get_SecondLeaders().l,h.alli.roleinfo=u.get_Roles().d;var f=MainData.get_Alliance().get_MemberData();h.alli.member=f}h.player={},h.player.name=playerName,h.player.id=playerId,h.player.accountid=accountId,h.player.creationDate=P.get_CreationDate(),h.player.fraction=P.get_Faction(),h.player.bases={},h.player.pve=c.bd,h.player.pvp=c.bd-c.bde,h.player.points=c.p,h.player.rank=c.r,h.player.hascode=c.hchc,h.player.maxcp=P.GetCommandPointMaxStorage(),h.player.actcp=I(P.GetCommandPointCount()),h.player.funds=MainData.get_Inventory().get_PlayerFunds(),h.player.schirme=I(P.GetSupplyPointCount()),h.player.RPoints=P.get_ResearchPoints(),h.player.CreditsCount=I(P.GetCreditsCount());var b,S=MainData.get_Player(),G=S.get_Faction(),n=ClientLib.Base.Tech.GetTechIdFromTechNameAndFaction(ClientLib.Base.ETechName.Research_BaseFound,G),T=S.get_PlayerResearch().GetResearchItemFomMdbId(n).get_NextLevelInfo_Obj(),f=[];for(b in T.rr)0<T.rr[b].t&&(f[T.rr[b].t]=T.rr[b].c);var B=f[ClientLib.Base.EResourceType.Gold],p=f[ClientLib.Base.EResourceType.ResearchPoints],r=S.get_Credits(),x=(r.Delta+r.ExtraBonusDelta)*ClientLib.Data.MainData.GetInstance().get_Time().get_StepsPerHour(),m=(B-P.GetCreditsCount())/x;h.player.timeTOmcv=I(3600*m),h.player.rpNeeded=p;var A=MainData.get_Cities(),D=c.c.length;for(h.player.basecount=D,b=0;b<D;b++){var w=A.GetCity(c.c[b].i),S={};S.Id=c.c[b].i,S.Na=w.get_Name(),S.Po=c.c[b].p,S.Lvl=parseFloat(w.get_LvlBase().toFixed(2)),S.Off=parseFloat(w.get_LvlOffense().toFixed(2)),S.Def=parseFloat(w.get_LvlDefense().toFixed(2)),S.PosX=c.c[b].x,S.PosY=c.c[b].y;var t=w.get_CityUnitsData();S.repInf=0<S.Off?t.GetRepairTimeFromEUnitGroup(ClientLib.Data.EUnitGroup.Infantry,!1):0,S.repVeh=0<S.Off?t.GetRepairTimeFromEUnitGroup(ClientLib.Data.EUnitGroup.Vehicle,!1):0,S.repAir=0<S.Off?t.GetRepairTimeFromEUnitGroup(ClientLib.Data.EUnitGroup.Aircraft,!1):0,S.maxRep=0<S.Off?w.GetResourceMaxStorage(ClientLib.Base.EResourceType.RepairChargeInf):0,S.availRep=0<S.Off?ClientLib.Base.Resource.GetResourceCount(w.get_RepairOffenseResources().get_RepairChargeOffense()):0;var C=w.get_SupportWeapon();S.supWp=null===C?'':C.n,C=w.get_SupportData(),S.supWplvl=null===C?0:C.get_Level();var M=w.get_CityBuildingsData();C=M.GetUniqueBuildingByTechName(ClientLib.Base.ETechName.Construction_Yard),S.CY=null===C?0:C.get_CurrentLevel(),C=M.GetUniqueBuildingByTechName(ClientLib.Base.ETechName.Defense_Facility),S.DF=null===C?0:C.get_CurrentLevel(),C=M.GetUniqueBuildingByTechName(ClientLib.Base.ETechName.Defense_HQ),S.DHQ=null===C?0:C.get_CurrentLevel(),S.PP=I(w.GetResourceGrowPerHour(ClientLib.Base.EResourceType.Power,!1,!1)),S.PBP=I(w.GetResourceBonusGrowPerHour(ClientLib.Base.EResourceType.Power)),S.PAB=ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Power),S.CP=I(ClientLib.Base.Resource.GetResourceGrowPerHour(w.get_CityCreditsProduction(),!1)),S.CBP=I(ClientLib.Base.Resource.GetResourceBonusGrowPerHour(w.get_CityCreditsProduction(),!1)),S.Tall=I(w.GetResourceGrowPerHour(ClientLib.Base.EResourceType.Tiberium,!1,!1)+w.GetResourceBonusGrowPerHour(ClientLib.Base.EResourceType.Tiberium)+ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Tiberium)),S.Call=I(w.GetResourceGrowPerHour(ClientLib.Base.EResourceType.Crystal,!1,!1)+w.GetResourceBonusGrowPerHour(ClientLib.Base.EResourceType.Crystal)+ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Crystal)),S.PPall=S.PP+S.PBP+S.PAB,S.CPall=S.CP+S.CBP,h.player.bases[b]=S,h.player.bases[b].cncopt=o(S.Id,b)}for(var R in h.player.mainoff=0,h.player.maindef=0,h.player.mainavailrep=0,h.player.mainrepinf=0,h.player.mainrepveh=0,h.player.mainrepair=0,h.player.supschnitt=0,h.player.defschnitt=0,h.player.tibgesamt=0,h.player.crigesamt=0,h.player.cashgesamt=0,h.player.powergesamt=0,h.player.mainpower=0,h.player.bases)delete h.player.bases[R].PP,delete h.player.bases[R].PBP,delete h.player.bases[R].PAB,delete h.player.bases[R].CP,delete h.player.bases[R].CBP,h.player.bases[R].Off>h.player.mainoff&&(h.player.mainoff=h.player.bases[R].Off,h.player.mainpower=h.player.bases[R].PPall,h.player.maindef=h.player.bases[R].Def,h.player.mainavailrep=h.player.bases[R].availRep,h.player.mainrepinf=h.player.bases[R].repInf,h.player.mainrepveh=h.player.bases[R].repVeh,h.player.mainrepair=h.player.bases[R].repAir),h.player.supschnitt+=h.player.bases[R].supWplvl,h.player.defschnitt+=h.player.bases[R].Def,h.player.tibgesamt+=h.player.bases[R].Tall,h.player.crigesamt+=h.player.bases[R].Call,h.player.cashgesamt+=h.player.bases[R].CPall,h.player.powergesamt+=h.player.bases[R].PPall;h.player.supschnitt/=h.player.basecount,h.player.defschnitt/=h.player.basecount,h.player.supschnitt=h.player.supschnitt.toFixed(2),h.player.defschnitt=h.player.defschnitt.toFixed(2);var y=h.player.bases;if(delete h.player.bases,h.player.bases=y,null!==O.xhr._xhr)xhr=O.xhr,xhr.send('https://www.member-stats.de/playerinfo.php?i=playerinfos','POST',null,h,this.callback);else{var L={func:'playerinfo',class:'CncEcoPlayerinfo',error:'CncEco.xhr.req !== null'};_('CncEco.xhr.req !== null'),beta&&s('CncEco.xhr.req !== null',L)}}catch(t){L={func:'playerinfo',class:'CncEcoPlayerinfo'},L.error=t,_(t),beta&&s(t,L)}},callback:function(t){try{!1!==JSON.isjson(t)&&('parse'===JSON.isjson(t)?JSON.parse(t):'stringify'===JSON.isjson(t)&&JSON.stringify(t))}catch(n){t={func:'callback',class:'CncEcoPlayerinfo'},t.error=n,_(n),beta&&s(n,t)}}}}),qx.Class.define('CncEcoreport.window',{extend:qx.ui.window.Window,construct:function(){qx.ui.window.Window.call(this),this.set({caption:'CncEco Info',icon:'webfrontend/ui/icons/icn_show_combat_active.png',layout:new qx.ui.layout.VBox(4),width:300,height:50,contentPaddingTop:0,contentPaddingBottom:6,contentPaddingRight:6,contentPaddingLeft:6,showMaximize:!1,showMinimize:!1,allowMaximize:!1,allowMinimize:!1,resizable:!0,visibility:'excluded',textColor:'#bfbfbf'}),this.getChildControl('icon').set({scale:!0,width:18,height:17,alignY:'middle',marginLeft:8}),this.add(this.logContainer=new qx.ui.container.Composite(new qx.ui.layout.VBox())),this.add(new qx.ui.core.Spacer,{flex:1}),this.addListener('close',function(){this.onClose()})},members:{logContainer:null,onClose:function(){this.removeAll(),this.add(this.logContainer=new qx.ui.container.Composite(new qx.ui.layout.VBox()))},push:function(t,n){this.isActive()||this.open(),this.logContainer.add(new qx.ui.basic.Label(t.toString())),n&&this.logContainer.add(n)},delall:function(){this.removeAll(),this.add(this.logContainer=new qx.ui.container.Composite(new qx.ui.layout.VBox()))},initialize:function(){try{_('CncEcoreport.window loadet')}catch(t){_(t)}}}});var n={_g:function(t,n,o,r){t=t.toString().replace(/\s/gim,''),n=t.match(n);var s;for(s=1;s<r+1;s++)null!==n&&6===n[s].length?console.debug(o,s,n[s]):null!==n&&0<n[s].length?console.warn(o,s,n[s]):(console.error('Error - ',o,s,'not found'),console.warn(o,t));return n},patch:function(){if(!D._patched){var t=ClientLib.Data.WorldSector.WorldObjectCity.prototype,t=ClientLib.Data.WorldSector.WorldObjectNPCBase.prototype;re=/100\){0,1};this\.(.{6})=Math.floor.*d\+=f;this\.(.{6})=\(/;var o=n._g(t.$ctor,re,'ClientLib.Data.WorldSector.WorldObjectNPCBase',2);null!==o&&6===o[1].length?t.getLevel=function(){return this[o[1]]}:console.error('Error - ClientLib.Data.WorldSector.WorldObjectNPCBase.Level undefined'),null!==o&&6===o[2].length?t.getID=function(){return this[o[2]]}:console.error('Error - ClientLib.Data.WorldSector.WorldObjectNPCBase.ID undefined'),t=ClientLib.Data.WorldSector.WorldObjectNPCCamp.prototype,re=/100\){0,1};this\.(.{6})=Math.floor.*this\.(.{6})=\(*g\>\>(22|0x16)\)*\&.*=-1;\}this\.(.{6})=\(/;var r=n._g(t.$ctor,re,'ClientLib.Data.WorldSector.WorldObjectNPCCamp',4);null!==r&&6===r[1].length?t.getLevel=function(){return this[r[1]]}:console.error('Error - ClientLib.Data.WorldSector.WorldObjectNPCCamp.Level undefined'),null!==r&&6===r[2].length?t.getCampType=function(){return this[r[2]]}:console.error('Error - ClientLib.Data.WorldSector.WorldObjectNPCCamp.CampType undefined'),null!==r&&6===r[4].length?t.getID=function(){return this[r[4]]}:console.error('Error - ClientLib.Data.WorldSector.WorldObjectNPCCamp.ID undefined'),D._patched=!0}}},D=null;return qx.Class.define('CncEcoScanner',{type:'singleton',extend:qx.core.Object,members:{initialize:function(){try{_('Scanner loadet\n'),CncEcomain.getInstance().AddMainMenu('scan layouts',function(){CncEcoScanner.getInstance().scan()},'Alt+s'),D=CncEcoScanner.getInstance(),D.win=CncEcomain.getInstance().getWindow(),D.storage=CncEcostorage.getInstance(),D.xhr=O.xhr,D.winOpen=CncEcomain.getInstance(),D.startup()}catch(t){_(t)}},_patched:!1,_bases:{},_selectionBases:{},_scanned:[],_toScan:[],_scanning:!1,failCount:0,wincounter:0,basecounter:0,button:function(){if(!0===D._abort){var t=new qx.ui.form.Button('resume');t.addListener('execute',function(){D.resume()},this)}else t=new qx.ui.form.Button('stop'),t.addListener('execute',function(t){D.abort();var n=ClientLib.Data.MainData.GetInstance();t=n.get_Player().get_Name();var o=n.get_Server().get_WorldId(),n=n.get_Alliance().get_Id();D.xhr.send('https://cnc-eco.herokuapp.com/api/v1/layouts?pl='+t+'&w='+o+'&a='+n,'POST',null,D._bases,_)},this);return t},scan:function(t){if(_('start scan'),D._scanning)_('BaseScanner._scanning');else if(null==t&&(D.win.isActive()&&(D.win.delall(),D.win.close()),D.win.open()),!0===D._abort)D.resume();else{D.win.push('start Scanning'),D._bases={},D._scanning=!0,D._count=0,D._done=0,D.index=-1,D._toScanMap={},D._toScan=[],D.basecounter=0,t=D.storage.get('scan'),Array.isArray(t)||(D.storage.set('scan','[]'),t=D.storage.get('scan'));for(var n=D.storage.get('scan').length;800<=n;)t.shift(),n--,800>=n&&D.storage.set('scan',t);for(var o in t=ClientLib.Data.MainData.GetInstance().get_Cities().get_AllCities().d,t)t.hasOwnProperty(o)&&(n=t[o],void 0===n&&_('unable to find base: '+o),D.getNearByBases(n));D.scanNextBase()}},getNearByBases:function(t){for(var o=Math.sqrt,s,d=t.get_PosX(),c=t.get_PosY(),l=ClientLib.Data.MainData.GetInstance().get_Server().get_MaxAttackDistance()-.5,u=ClientLib.Data.MainData.GetInstance().get_World(),n=0,g=c-11;g<=c+11;g++)for(var _=d-11;_<=d+11;_++){var y=C(d-_),b=C(c-g),y=o(y*y+b*b);if(!(y>=l||void 0!==D._toScanMap[_+':'+g]||void 0!==D._bases[_+':'+g]||(b=u.GetObjectFromPosition(_,g),null===b||b.Type!==ClientLib.Data.WorldSector.ObjectType.NPCBase&&b.Type!==ClientLib.Data.WorldSector.ObjectType.NPCCamp||'function'==typeof b.getCampType&&b.getCampType()===ClientLib.Data.Reports.ENPCCampType.Destroyed))){var I=0;if(null===D.storage.get('scan'))D.storage.set('scan','[]');else if(s=D.storage.get('scan'),!0===Array.isArray(s))for(var w=D.storage.get('scan').length,P=0;P<w;P++)b.getID()===s[P]&&(I=1);else D.storage.set('scan','[]');0<I||(s=D.storage.get('scan'),s.push(b.getID()),CncEcostorage.getInstance().set('scan',s),w=ClientLib.Data.MainData.GetInstance(),s=w.get_Player().get_Name(),I=w.get_Server().get_WorldId(),w=w.get_Alliance().get_Id(),y={x:_,y:g,level:b.getLevel(),id:b.getID(),distance:y,selectedBaseID:t.get_Id(),alliance:w,world:I,player:s,failCount:0},D._toScan.push(y),D._toScanMap[_+':'+g]=y,n++)}}},abort:function(){D._scanning=!1,D._abort=!0,D.win.delall(),D.win.push('stop scan'),D.win.push(('   '+D.index).slice(-3)+'/'+D._toScan.length),D.win.push('',D.button())},resume:function(){D._scanning=!0,D._abort=!1,D.win.delall(),D.win.push('resume scan'),D.win.push(('   '+D.index).slice(-3)+'/'+D._toScan.length),D.win.push('',D.button()),D.scanNextBase()},done:function(){D._done++;var t=ClientLib.Data.MainData.GetInstance(),n=t.get_Player().get_Name(),o=t.get_Server().get_WorldId(),r=t.get_Alliance().get_Id();!1===D._scanning&&D._count===D._done&&!1===D._abort?(D.win.push(''),0<D._count?(D.win.push('Done! ('+D._count+')'),D.win.push(''),D.xhr.send('https://cnc-eco.herokuapp.com/api/v1/layouts?pl='+n+'&w='+o+'&a='+r,'POST',null,D._bases,_),D.winOpen.winOpen('layout','layout'),5>Object.keys(D._bases).length&&(t=CncEcoScanner.Layout.window.getInstance(),!0!==t.active&&(t.active=!0,t.openWindow('CncEco Scan result',null,1)),t.FO(D._bases),D.xhr.send('https://cnc-eco.herokuapp.com/api/v1/layouts?pl='+n+'&w='+o+'&a='+r,'POST',null,D._bases,_),D._bases={})):(D.win.push('Done! 0 new layouts to scan'),D.win.push(''))):!1===D._scanning&&D._count+1===D._done&&!1===D._abort?(D.win.delall(),D.win.push(''),0<D._count?(D.win.push('Done! ('+D._count+')'),D.win.push(''),D.xhr.send('https://cnc-eco.herokuapp.com/api/v1/layouts?pl='+n+'&w='+o+'&a='+r,'POST',null,D._bases,_),D.winOpen.winOpen('layout','layout'),5>Object.keys(D._bases).length&&(t=CncEcoScanner.Layout.window.getInstance(),!0!==t.active&&(t.active=!0,t.openWindow('CncEco Scan result',null,1)),t.FO(D._bases),D.xhr.send('https://cnc-eco.herokuapp.com/api/v1/layouts?pl='+n+'&w='+o+'&a='+r,'POST',null,D._bases,_),D._bases={})):(D.win.push('Done! 0 new layouts to scan'),D.win.push(''))):!1===D._scanning&&!1===D._abort&&D.win.push('Scan')},getBaseLayout:function(t){var o=ClientLib.Data.MainData.GetInstance(),r=o.get_Player().get_Name(),s=o.get_Server().get_WorldId(),o=o.get_Alliance().get_Id();if(!D._abort)if(void 0===t)D._abort=!1,D._scanning=!1,!1===D._abort&&D.done(),_('[BaseScanner] base undefined');else{D._lastBaseID!==t.selectedBaseID&&D.setCurrentBase(t.selectedBaseID),ClientLib.Data.MainData.GetInstance().get_Cities().set_CurrentCityId(t.id);var d=ClientLib.Data.MainData.GetInstance().get_Cities().GetCity(t.id);if(ClientLib.Net.CommunicationManager.GetInstance().UserAction(),d.get_IsGhostMode())return D.scanNextBase();if(0===d.GetBuildingsConditionInPercent())return t.failCount++,30===t.failCount?(_('[BaseScanner] max_fails'),D.scanNextBase()):setTimeout(function(){D.getBaseLayout(t)},99);var l=d.get_Name();t.layout=D.getLayout(d),t.name=l,D._bases[t.x+':'+t.y]=t,D.basecounter++,d=CncEcoScanner.Layout.window.getInstance(),!0!==d.active&&(d.active=!0,d.openWindow('CncEco Scan result',null,1)),4<D.basecounter&&(D.basecounter=0,d.FO(D._bases),D.xhr.send('https://cnc-eco.herokuapp.com/api/v1/layouts?pl='+r+'&w='+s+'&a='+o,'POST',null,D._bases,_),D._bases={}),ClientLib.Data.MainData.GetInstance().get_Server().get_WorldId(),ClientLib.Data.MainData.GetInstance().get_Player().get_Name(),D._count++,D.printScanResults(t),D.done(),D.scanNextBase()}},scanNextBase:function(){!0!==D._abort&&(void 0===D.index?D.index=0:D.index++,D.getBaseLayout(D._toScan[D.index]))},isScanning:function(){return!0===D._scanning},printScanResults:function(){if(D.win.delall(),!1===D._abort)switch(D.wincounter){case 0:D.wincounter++,D.win.push('Scanning');break;case 1:D.wincounter++,D.win.push('Scanning.');break;case 2:D.wincounter++,D.win.push('Scanning..');break;case 3:D.wincounter=0,D.win.push('Scanning...');break;default:D.win.push('Scanning');}else D.win.push('Scanning');D.win.push(('   '+D.index).slice(-3)+'/'+D._toScan.length),D.win.push('',D.button())},getLayout:function(t){for(var n=[],o=0;16>o;o++)for(var r=0;9>r;r++)switch(t.GetResourceType(r,o)){case 0:n.push('.');break;case 1:n.push('c');break;case 2:n.push('t');break;case 4:n.push('j');break;case 5:n.push('h');break;case 6:n.push('l');break;case 7:n.push('k');}return n.join('')},setCurrentBase:function(t){var n=ClientLib.Data.MainData.GetInstance().get_Cities().get_AllCities().d[t];ClientLib.Vis.VisMain.GetInstance().CenterGridPosition(n.get_PosX(),n.get_PosY()),ClientLib.Vis.VisMain.GetInstance().Update(),ClientLib.Vis.VisMain.GetInstance().ViewUpdate(),D._lastBaseID=t},startup:function(){n.patch(),phe.cnc.Util.attachNetEvent(ClientLib.Vis.VisMain.GetInstance(),'ViewModeChange',ClientLib.Vis.SelectionChange,D,D.onSelectionChange)},destroy:function(){phe.cnc.Util.detachNetEvent(ClientLib.Vis.VisMain.GetInstance(),'ViewModeChange',ClientLib.Vis.SelectionChange,D,D.onSelectionChange)},onSelectionChange:function(){try{if(!D.isScanning()&&!0!==D._abort){D.failCount=0,D._bases={},D._count=0,D._done=0,D.index=-1,D._toScanMap={},D._toScan=[],void 0!==D.selectionChange&&(clearTimeout(D.selectionChange),D.selectionChange=void 0);var t=ClientLib.Vis.VisMain.GetInstance().get_SelectedObject(),t=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity();if(null!==t&&!0===ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity().IsNPC()){for(id in D._scanned)if(D._scanned[id]==t.get_Id())return void console.log('already scanned');D._scanned.push(t.get_Id()),D.scanCurrentBase()}}}catch(t){console.log(t)}},scanCurrentBase:function(){var t=ClientLib.Data.MainData.GetInstance().get_Cities(),o=t.get_CurrentCity(),r=t.get_CurrentOwnCity();if(D.failCount++,!(30<D.failCount)){if(null===o)return _('base = 0'),D.selectionChange=setTimeout(D.scanCurrentBase,100),D.selectionChange;void 0!==D.selectionChange&&(clearTimeout(D.selectionChange),D.selectionChange=void 0);var t=o.get_PosX(),s=o.get_PosY();if(o.get_Id(),o.get_IsGhostMode())D.failCount=0;else if(0===o.GetBuildingsConditionInPercent())D.selectionChange=setTimeout(D.scanCurrentBase,100);else{D.failCount=0;var d=ClientLib.Data.MainData.GetInstance(),l=d.get_Player().get_Name(),n=d.get_Server().get_WorldId(),d=d.get_Alliance().get_Id(),u=ClientLib.Base.Util.CalculateDistance(o.get_PosX(),o.get_PosY(),r.get_PosX(),r.get_PosY()),r={x:o.get_PosX(),y:o.get_PosY(),level:o.get_BaseLevel(),id:o.get_Id(),distance:u,selectedBaseID:r.get_Id(),alliance:d,world:n,player:l,failCount:0},u=o.get_Name();r.layout=D.getLayout(o),r.name=u,r.alliance=ClientLib.Data.MainData.GetInstance().get_Alliance().get_Id(),D._bases[t+':'+s]=r,D._selectionBases[t+':'+s]=r,ClientLib.Data.MainData.GetInstance().get_Server().get_WorldId(),ClientLib.Data.MainData.GetInstance().get_Player().get_Name(),ClientLib.Data.MainData.GetInstance().get_Alliance().get_Id(),D.xhr.send('https://cnc-eco.herokuapp.com/api/v1/layouts?pl='+l+'&w='+n+'&a='+d,'POST',null,D._bases,_)}}}}}),qx.Class.define('CncEcostorage',{type:'singleton',extend:qx.core.Object,members:{get:function(t){return t=localStorage.getItem('CncEco:'+t),null===t?t:JSON.parse(t)},set:function(t,n){return null===n||void 0===n?O.storage.remove(t):('string'!=typeof n&&(n=JSON.stringify(n)),localStorage.setItem('CncEco:'+t,n))},remove:function(t){return localStorage.removeItem('CncEco:'+t)},initialize:function(){try{_('CncEcostorage loadet')}catch(t){_(t)}}}}),qx.Class.define('CncEcoxhr',{type:'singleton',extend:qx.core.Object,members:{send:function(t,n){var o=new qx.bom.request.Xhr()._createNativeXhr();o.timeout=3e3,o.onload=function(){1==o.responseText?_('CncEcoxhr Send true!'):0==o.responseText?_('CncEcoxhr is Error :: '+o.responseText):1!==o.responseText,o.abort()},o.ontimeout=function(){_('xhr timeout'),o.abort()},o.onloadend=function(){_('xhr timeout'),o.abort()},o.open('POST',t,!0),o.setRequestHeader('Method','POST'),o.setRequestHeader('Content-Type','application/json'),o.send(JSON.stringify(n))},initialize:function(){try{_('CncEcoxhr loadet')}catch(t){_(t)}}}}),O.xhr={_load:!1,_xhr:null,_timeout:3e3,start:function(){var t=null;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject('Msxml2.XMLHTTP.6.0')}catch(n){try{t=new ActiveXObject('Msxml2.XMLHTTP.3.0')}catch(t){_(t)}}return null!==t&&(O.xhr._load=!0,O.xhr._xhr=t,O.xhr._xhr.timeout=O.xhr._timeout,O.xhr._load)},send:function(t,o,r,s,d){try{if(null!==O.xhr._xhr)if(!1!==O.xhr._load&&null!==O.xhr._xhr){if(O.xhr._xhr.open(o,t,!0),null!==r&&'object'==typeof r)for(var l in r)r[l].hasOwnProperty('name')&&r[l].hasOwnProperty('value')&&O.xhr._xhr.setRequestHeader(r[l].name,r[l].value);O.xhr._xhr.onload=function(){try{4==O.xhr._xhr.readyState&&200==O.xhr._xhr.status&&'function'==typeof d&&d(O.xhr._xhr.responseText)}catch(t){_(t)}},null===s?O.xhr._xhr.send(null):'stringify'==JSON.isjson(s)&&!0===Array.isarray(s)||!0===Object.isobj(s)&&'stringify'==JSON.isjson(s)?O.xhr._xhr.send(JSON.stringify(s)):_(e)}else alert('Ihr Browser unterstuetzt kein Ajax!')}catch(t){_(t)}}},qx.Class.define('CncEcoScanner.Layout.window',{type:'singleton',extend:qx.ui.window.Window,construct:function(){try{this.base(arguments),this.setWidth(925),this.setHeight(700),this.setContentPadding(10),this.setShowMinimize(!1),this.setShowMaximize(!0),this.setShowClose(!0),this.setResizable(!0),this.setAllowMaximize(!0),this.setAllowMinimize(!1),this.setAllowClose(!0),this.setShowStatusbar(!1),this.setDecorator(null),this.setPadding(10),this.setLayout(new qx.ui.layout.Grow),this.addListener('close',function(){this.active=!1,this.row=0,this.ZW=[],this.removeAll(),this.ZZ=new qx.ui.container.Scroll,this.ZY=new qx.ui.container.Composite(new qx.ui.layout.Flow()),this.add(this.ZZ,{flex:3}),this.ZZ.add(this.ZY)},this),this.ZW=[],this.removeAll(),this.ZZ=new qx.ui.container.Scroll,this.ZY=new qx.ui.container.Composite(new qx.ui.layout.Flow()),this.add(this.ZZ,{flex:3}),this.ZZ.add(this.ZY)}catch(t){console.debug('CncEcoScanner.Layout.window construct: ',t)}},members:{ZW:null,ZZ:null,ZY:null,ZX:null,row:0,openWindow:function(t,n,o){try{''!==t&&this.setCaption(t),this.isVisible()&&null===n?this.close():null===o?(this.open(),this.moveTo(30,100),null===n?this.FO():this.FO(n)):(this.open(),this.moveTo(30,100))}catch(t){console.log('CncEcoScanner.Layout.window.openWindow: ',t)}},listener:function(t){var n=qx.core.Init.getApplication();n.getBackgroundArea().closeCityInfo(),n.getPlayArea().setView(ClientLib.Data.PlayerAreaViewMode.pavmCombatSetupDefense,t,0,0),n=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentOwnCity(),null!=n&&n.get_CityArmyFormationsManager().set_CurrentTargetBaseId(t)},FO:function(o){try{if(!0!==this.active)return setTimeout(function(){this.openWindow('',o)},90);var s,c={".":'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAADUExURQAAAKd6PdoAAAABdFJOUwBA5thmAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==',c:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAGMUExURQAAAJvj+p3l+57m+5vj+prj+p7m+5nh+pni+pri+pni+pri+pvj+5ri+pzl+57n+57m+5ff+Z7m+5nh+qDv/Zvj+57m+6Hr/KL6/pni+p30/Zrl+53z/aLt/KL9/pf0/Zn3/Zv4/pfr+6L0/Zf3/Z7n+5fs+6L1/Zf6/qL8/qL2/pfm+qLw/AlQf5n8/BJVbwlTq3HQ05P29wRFaGzY3hZnhAtRn4zu7h2JtBVxnQMtShFidgZMdQdIk5/9/gY7eQI5YAY9lgY6QghmnAZIUQtUlUe26RmQzwhHXAqAvBFzwg9WjRXM4AtpkTGZowtbZwQscWSt3SuF2SiKk3/j5pLb8WD29UiZpFzR1VzP4htnmjS0xiVpdR2VswpIiSCb6Tap6Ac1g33s7kCq0CeDswQxYjSx2cf2/GrQ6x5mrGfH8izk9UzCyzWEmyuouw+XpAuPyi6ApDqLkF7GzWS9wxbD8TKJzEmPwB+x7ShDQRS90zKGmXHl9wdYtX3M6KHo+k6stWzoymS0yB9GXksjNTkAAAAzdFJOUwAHHxQLFxsBBQMkDQkoMUZCTyw3fBA9VOVYqWWhS/W53sh3sM9ok43r2b52cP///////t3sG3QAAAIISURBVCjPrZJVc9tAFEazwpVkkRljOw23smzZlpkZYjvMzFBmTOGPd5VkAtO+dKb3UWe+785dnaGhfxgazd8Jw0ATQQDIPOQ0AwEAhI2kMIy0EfBBBKLvCJgtksdq4UmCuZeDNooVJbvoGPMvRPyimQR3xQxBCVYt5LY+ckbWkwm3yHJ3UYibfVNHmyHnwupSvfE0MWIhb7fSJkzyxpZ29rW1xcW5udRyUEbRm2KG4x1TK1p9O7ZWa8/OJjcSjy0kuKEMLow568c7794fhPVOPK4mxmXeBq7XQkrKx051vVR4Ga4pivJZC3jtmA1et7KO/MZhKVwqbClKLhv9Hll+My6QwGAAFzzTkfRgd1dVy9Fcpv3tx+r+qISZjFIOEyece83BYGbzeTodz54eX54dTMosgSAKPgldrMd/9T91u61oOqe3z05mQjLPGUdS9umLlLqlds/P31aKh/rX2s8jBI0kTWBivpct6J3Glw/blWIh11H6/VdBu7GTIbCJlUyxFC5+TDVeVNRqtdXqRUZHzDg6hTFRPi2WiSrJeLmZypab0eTJpNclUMbb0wDnHW6tF8sP7z3LVOfnX4f8HhExSF+dQpkla9BrRT9seDgQcHtkC0sSVwxZwJFIAbsk+hwul0uWBJbkIHPrD+BsOEliGMvzPEvhHLhvGI38YiAESD3C9Id8/31+A0POUa1xABFzAAAAAElFTkSuQmCC',t:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAGbUExURQAAAJri+pvj+prj+pnh+pjg+prj+pjh+pri+pzk+5rj+pni+pzl+5ri+pjh+pnh+prj+pnh+pni+pni+pjw/Jzl+5/s/Jrn+5ff+Zzl+5fz/Z/p/Jzw/Zf0/Jrm+5r3/aL4/Zfh+p7t/Jvt/Jv1/Zfv/Jvw/Jf6/aL6/gtsLQ6IVBKiXghkNm/Sw5H49ARQHJj7+g+FNwhdLYzx7ByrThCNQXvo1w1/OAt2NSvNZhKgRxCdURFyPAdlJRe/ZA2TToPt4y+yZxBsNh2YXA6RW2jcvxW3TTXykCqAWkachqD+/oLk3UeogUCeeWDEplSxnCJwVBKlWBqPNwMyFA2SKAqAUhyGPn71qDSTYhxfPC/liFHFdiTjbqr4sFnFiyCWSRCaQzrCfg1/Rz3ubGj0sVbTp7v7yBC8LBvmNBNKOSrtbxLKKV7xgkvenV3AoHzZzk6/mFHXTAtXLGndrVq5Wcr8zUvvjF+9e2HkmnTmr0fWem7m0C2nfxnVSFKPbRvUakbehimOUz3ORRbDbmveyTnfjnH1hFnMph+1ZunFEtoAAAApdFJOUwAUEBgJCw4CBAYkKC4bPR80RzddoExze1NB0FWIxWrv1GWUmdyvu93GYZ5Q7AAAAgFJREFUKM+tUtVy2wAQjJhZZrZjJ5LMzAxhJoeZy8zc767kNqk7zVOn+3g7eze3uyMj/wcYhuvA7poSBAICEAAixB80TsAoCAAMSYsiTzEoMawjQIikad5mkuSxoEPkUHxIiHK0edzpNvu92cZ9lyQy8O/FBMQ74gdZrzf+5NFR+oHLSoG3UgylTKHOUSFVL+ys9wpr004Wur2KA6I5/vl779vXva3N4+3ijN1KoTcPEYwQqF+f9o5PtHR6q7u04TGzDPJrMUw6xt9s7lZbbxvVUiKRn/UE3TSEDKQ4SJujfVX7oqmt4mIpo8xFIymJAvDBk5DNMjURbmtqrhkr1fL7L56mOzLLwMZFkHL4PZOPV9XESmW5vJZ/9Wzn+YnLROokBjOscyp70FxQzq7OcrGyuvFy/XXLY6UQ40nSFN9dShz2r87P32XCYW2xcVrIxK2kQYK0L6qUD9XM5fXldjPZ1mr5vZWJMYGDB6Q8p6y2tYv3Hz90c+GkUswpkyk/b5ike+eMLITVWvKiv99txmKV6r2U3cKSRjIYwrFydDb5MBv5lKwsx5SZ+mhAYklgEAwBUDaLfdoeckU78/ORyKjsM/Ec+DM0HIFIUXBLPrcl6ArJAUngSQC58R2HQYgjKZpnbYIgsDQHDJcI0ysEI3qJGB0ACBPYHb00+vd3Mf8JPwDEQVFKmgSbiAAAAABJRU5ErkJggg=='},u=CncEcoScanner.getInstance()._bases;for(s in null!==o&&(u=o),u){var _=u[s].layout,g=_.match(/t/g).length,n=_.match(/c/g).length;switch(ClientLib.Data.MainData.GetInstance().get_Player().get_Faction()){case ClientLib.Base.EFactionType.GDIFaction:var l='G';break;case ClientLib.Base.EFactionType.NODFaction:l='N';}for(var m,y='http://cncopt.com/?map=2|'+l+'|'+l+'||'+_+'....................................|newEconomy',h='<table border="2" cellspacing="0" cellpadding="0" onclick="CncEcoScanner.Layout.window.getInstance().listener('+u[s].id+')">',h=h+('<tr><td colspan="9"><font color="#FFF">'+u[s].x+':'+u[s].y+'&nbsp;&nbsp;<img width="14" height="14" src="'+c.t+'"> '+g+' &nbsp;&nbsp; <img width="14" height="14" src="'+c.c+'"> '+n+'</font></td></tr>'),C=0;72>C;C++)m=C-9*t(C/9),0==m&&(h+='<tr>'),h+='<td><img width="14" height="14" src="'+c[_.charAt(C)]+'"></td>',8==m&&(h+='</tr>');h+='</table><a href="'+y+'" target="_blank" style="color:#FFFFFF;">CNCOpt',this.resourceLayout=new qx.ui.basic.Label().set({backgroundColor:'#303030',value:h,padding:10,rich:!0}),7==g?this.resourceLayout.setBackgroundColor('#202820'):5==g&&this.resourceLayout.setBackgroundColor('#202028'),this.ZW.push(this.resourceLayout)}for(this.ZY.removeAll(),l=0,this.row>l&&(l=this.row),a=c=0;a<this.ZW.length;a++)this.ZY.add(this.ZW[a],{row:l,column:c}),c++,5<c&&(c=0,l++,this.row++)}catch(t){console.log(t)}}}}),qx.Class.define('CncEcoHIDE.window.container',{extend:qx.ui.container.Composite,construct:function(t){try{switch(qx.ui.container.Composite.call(this),this.set({layout:new qx.ui.layout.VBox(5),padding:5,decorator:'pane-light-opaque'}),t){case'o':console.log('add container o'),this.add(new qx.ui.basic.Label('Hide Outposts').set({alignX:'center',font:'font_size_14_bold'}));var n=new qx.ui.container.Composite(new qx.ui.layout.HBox(5));n.add(new qx.ui.basic.Label(this.tr('level < ')).set({alignY:'middle'})),n.add(this.oLevel=new qx.ui.form.Spinner(1).set({maximum:65,minimum:1})),this.oLevel.addListener('changeValue',this.onInputo,this),n.add(this.btnLevelo=new qx.ui.form.Button('del').set({toolTipText:'delete outposts from view'})),this.btnLevelo.addListener('execute',this.delo,this),n.add(this.btnhideo=new qx.ui.form.Button('hide').set({toolTipText:'hide targetinfo from view'})),this.btnhideo.addListener('execute',this.hideo,this),this.add(n);break;case'c':console.log('add container c'),this.add(new qx.ui.basic.Label('Hide Camps').set({alignX:'center',font:'font_size_14_bold'})),n=new qx.ui.container.Composite(new qx.ui.layout.HBox(5)),n.add(new qx.ui.basic.Label(this.tr('level < ')).set({alignY:'middle'})),n.add(this.cLevel=new qx.ui.form.Spinner(1).set({maximum:65,minimum:1})),this.cLevel.addListener('changeValue',this.onInputc,this),n.add(this.btnLevelc=new qx.ui.form.Button('del').set({toolTipText:'delete camps from view'})),this.btnLevelc.addListener('execute',this.delc,this),n.add(this.btnhidec=new qx.ui.form.Button('hide').set({toolTipText:'hide targetinfo from view'})),this.btnhidec.addListener('execute',this.hidec,this),this.add(n);break;case'b':console.log('add container b'),this.add(new qx.ui.basic.Label('Hide Bases').set({alignX:'center',font:'font_size_14_bold'})),n=new qx.ui.container.Composite(new qx.ui.layout.HBox(5)),n.add(new qx.ui.basic.Label(this.tr('level < ')).set({alignY:'middle'})),n.add(this.bLevel=new qx.ui.form.Spinner(1).set({maximum:47,minimum:1})),this.bLevel.addListener('changeValue',this.onInputb,this),n.add(this.btnLevelb=new qx.ui.form.Button('del').set({toolTipText:'delete bases from view'})),this.btnLevelb.addListener('execute',this.delb,this),n.add(this.btnhideb=new qx.ui.form.Button('hide').set({toolTipText:'hide targetinfo from view'})),this.btnhideb.addListener('execute',this.hideb,this),this.add(n);break;case'p':console.log('add container p'),this.add(new qx.ui.basic.Label('Hide Player').set({alignX:'center',font:'font_size_14_bold'})),n=new qx.ui.container.Composite(new qx.ui.layout.HBox(5)),n.add(new qx.ui.basic.Label(this.tr('level < ')).set({alignY:'middle'})),n.add(this.pLevel=new qx.ui.form.Spinner(1).set({maximum:65,minimum:1})),this.pLevel.addListener('changeValue',this.onInputp,this),n.add(this.btnLevelp=new qx.ui.form.Button('del').set({toolTipText:'delete player from viev'})),this.btnLevelp.addListener('execute',this.delp,this),n.add(this.btnhidep=new qx.ui.form.Button('hide').set({toolTipText:'hide targetinfo from view'})),this.btnhidep.addListener('execute',this.hidep,this),this.add(n);break;case'reset':console.log('add container p'),this.add(new qx.ui.basic.Label('Reset all').set({alignX:'center',font:'font_size_14_bold'})),n=new qx.ui.container.Composite(new qx.ui.layout.HBox(5,'center')),n.add(this.btnReset=new qx.ui.form.Button('reset').set({toolTipText:'Reset view'})),this.btnReset.addListener('execute',this.reset,this),this.add(n);break;default:console.log('add container default'),this.add(new qx.ui.basic.Label('Hide all').set({alignX:'center',font:'font_size_14_bold'})),n=new qx.ui.container.Composite(new qx.ui.layout.HBox(5)),n.add(new qx.ui.basic.Label(this.tr('level < ')).set({alignY:'middle'})),n.add(this.aLevel=new qx.ui.form.Spinner(1).set({maximum:65,minimum:1})),this.aLevel.addListener('changeValue',this.onInputa,this),n.add(this.btnLevela=new qx.ui.form.Button('del').set({toolTipText:'delete all targets from view'})),this.btnLevela.addListener('execute',this.dela,this),n.add(this.btnhidea=new qx.ui.form.Button('hide').set({toolTipText:'hide targetinfo from view'})),this.btnhidea.addListener('execute',this.hidea,this),this.add(n);}this.dirtySectors={}}catch(t){console.log('Error setting up CncEcoHIDE.window.container Constructor: '),console.log(t.toString())}},destruct:function(){},members:{dirtySectors:null,oLevel:null,btnHideCurrent:null,btndelCurrent:null,cLevel:null,bLevel:null,pLevel:null,aLevel:null,btnLevelo:null,btnLevelc:null,btnLevelb:null,btnLevelp:null,btnLevela:null,btnReset:null,btnhideo:null,btnhidec:null,btnhideb:null,btnhidep:null,btnhidea:null,markDirty:function(t){t.get_Id()in this.dirtySectors||(this.dirtySectors[t.get_Id()]={alliance:[],player:[]})},onTick:function(){this.onInput()},onInputo:function(){this.onInput('o')},onInputc:function(){this.onInput('c')},onInputb:function(){this.onInput('b')},onInputp:function(){this.onInput('p')},onInputa:function(){this.onInput('a')},hideo:function(){this.hide('o')},hidec:function(){this.hide('c')},hideb:function(){this.hide('b')},hidep:function(){this.hide('p')},hidea:function(){this.hide('a')},delo:function(){this.del('o')},delc:function(){this.del('c')},delb:function(){this.del('b')},delp:function(){this.del('p')},dela:function(){this.del('a')},onInput:function(t){switch(t){case'o':var n=parseInt(this.oLevel.getValue(),10);break;case'c':n=parseInt(this.cLevel.getValue(),10);break;case'p':n=parseInt(this.pLevel.getValue(),10);break;case'b':n=parseInt(this.bLevel.getValue(),10);break;case'a':n=parseInt(this.aLevel.getValue(),10);}console.log('value is '+n+' from '+t)},del:function(o){for(var r=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentOwnCity(),s=r.get_X(),r=r.get_Y(),c=ClientLib.Data.MainData.GetInstance().get_World(),d=ClientLib.Vis.VisMain.GetInstance().get_Region(),u=s-16;u<s+16;u++)for(var g,_=r-16;_<r+16;_++)if(g=d.GetObjectFromPosition(u*d.get_GridWidth(),_*d.get_GridHeight()),null!=g){var p=c.GetWorldSectorByCoords(u,_);'function'==typeof g.get_BaseLevel&&(g.get_VisObjectType()==ClientLib.Vis.VisObject.EObjectType.RegionNPCCamp&&(2===g.get_CampType()&&'c'==o&&t(g.get_BaseLevel())<parseInt(this.cLevel.getValue(),10)&&(g.Dispose(),this.markDirty(p)),3===g.get_CampType()&&'o'==o&&t(g.get_BaseLevel())<parseInt(this.oLevel.getValue(),10)&&(g.Dispose(),this.markDirty(p)),0===g.get_CampType()&&(g.Dispose(),this.markDirty(p))),g.get_VisObjectType()==ClientLib.Vis.VisObject.EObjectType.RegionCityType&&'p'==o&&t(g.get_BaseLevel())<parseInt(this.pLevel.getValue(),10)&&!g.IsOwnBase()&&(g.Dispose(),this.markDirty(p)),g.get_VisObjectType()==ClientLib.Vis.VisObject.EObjectType.RegionNPCBase&&'b'==o&&t(g.get_BaseLevel())<parseInt(this.bLevel.getValue(),10)&&(g.Dispose(),this.markDirty(p)),'a'==o&&t(g.get_BaseLevel())<parseInt(this.aLevel.getValue(),10)&&('function'==typeof g.IsOwnBase?g.IsOwnBase()||(g.Dispose(),this.markDirty(p)):(g.Dispose(),this.markDirty(p))))}console.log(this.dirtySectors)},hide:function(n){for(var o=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentOwnCity(),r=o.get_X(),o=o.get_Y(),s=ClientLib.Vis.VisMain.GetInstance().get_Region(),d=r-16;d<r+16;d++)for(var c,u=o-16;u<o+16;u++)c=s.GetObjectFromPosition(d*s.get_GridWidth(),u*s.get_GridHeight()),null!=c&&'function'==typeof c.get_BaseLevel&&(c.get_VisObjectType()==ClientLib.Vis.VisObject.EObjectType.RegionNPCCamp&&(2===c.get_CampType()&&'c'==n&&t(c.get_BaseLevel())<parseInt(this.cLevel.getValue(),10)&&c.HideInfos(),3===c.get_CampType()&&'o'==n&&t(c.get_BaseLevel())<parseInt(this.oLevel.getValue(),10)&&c.HideInfos(),0===c.get_CampType()&&c.HideInfos()),c.get_VisObjectType()==ClientLib.Vis.VisObject.EObjectType.RegionCityType&&'p'==n&&t(c.get_BaseLevel())<parseInt(this.pLevel.getValue(),10)&&(c.IsOwnBase()||c.HideInfos()),c.get_VisObjectType()==ClientLib.Vis.VisObject.EObjectType.RegionNPCBase&&'b'==n&&t(c.get_BaseLevel())<parseInt(this.bLevel.getValue(),10)&&c.HideInfos(),'a'==n&&t(c.get_BaseLevel())<parseInt(this.aLevel.getValue(),10)&&('function'==typeof c.IsOwnBase?c.IsOwnBase()||c.HideInfos():c.HideInfos()))},reset:function(){console.log('reset view'),this.showAll()},showAll:function(){try{ClientLib.Vis.VisMain.GetInstance().get_Region().ShowAllPlates()}catch(t){console.log(t)}}}}),qx.Class.define('CncEcoHIDE.window.Window',{type:'singleton',extend:qx.ui.window.Window,construct:function(){try{this.base(arguments),this.set({layout:new qx.ui.layout.VBox().set({spacing:0}),contentPadding:5,contentPaddingTop:0,allowMaximize:!1,showMaximize:!1,allowMinimize:!1,showMinimize:!1,resizable:!1}),this.setCaption('Hide targets'),this.moveTo(150,50),this.add(new CncEcoHIDE.window.container('o')),this.add(new CncEcoHIDE.window.container('c')),this.add(new CncEcoHIDE.window.container('b')),this.add(new CncEcoHIDE.window.container('p')),this.add(new CncEcoHIDE.window.container('a')),this.add(new CncEcoHIDE.window.container('reset')),this.addListener('appear',this.onOpen,this),this.addListener('close',this.onClose,this)}catch(t){console.log('Error setting up CncEcoHIDE.window.Window Constructor: '),console.log(t.toString())}},destruct:function(){},members:{view:{},onOpen:function(){console.log('Window onOpen ')},onClose:function(){console.log('Window onClose ')},initialize:function(){try{CncEcomain.getInstance().AddMainMenu('Hide targets',function(){CncEcoHIDE.window.Window.getInstance().open()},'Alt+h'),phe.cnc.Util.attachNetEvent(ClientLib.Vis.VisMain.GetInstance(),'ViewModeChange',ClientLib.Vis.ViewModeChange,this,this.viewChangeHandler),this.btnHideCurrent=new qx.ui.form.Button('Hide'),this.btnHideCurrent.set({width:50,appearance:'button-text-small',toolTipText:'Hide From Map'}),this.btnHideCurrent.addListener('click',this.hideCurrent,this),this.btndelCurrent=new qx.ui.form.Button('del'),this.btndelCurrent.set({width:50,appearance:'button-text-small',toolTipText:'Delete From Map'}),this.btndelCurrent.addListener('click',this.delCurrent,this)}catch(t){_(t)}},viewChangeHandler:function(t,n){try{var o=qx.core.Init.getApplication().getUIItem(ClientLib.Data.Missions.PATH.OVL_PLAYAREA),r=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity();null!=r&&((this.view.ownCity=r===ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentOwnCity(),this.view.ownCity||n!==ClientLib.Vis.Mode.CombatSetup)?t===ClientLib.Vis.Mode.CombatSetup&&(o.remove(this.btnHideCurrent),o.remove(this.btndelCurrent)):(o.add(this.btnHideCurrent,{right:1,top:33}),o.add(this.btndelCurrent,{right:1,top:60})))}catch(t){console.log(t)}},hideCurrent:function(){try{var t=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity(),n=t.get_PosX(),o=t.get_PosY(),r=ClientLib.Vis.VisMain.GetInstance().get_Region();r.GetObjectFromPosition(n*r.get_GridWidth(),o*r.get_GridHeight()).HideInfos(),qx.core.Init.getApplication().getMainOverlay()._onClose()}catch(t){console.log(t)}},delCurrent:function(){console.log('___________del___________');try{var t=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity(),n=t.get_PosX(),o=t.get_PosY(),r=ClientLib.Vis.VisMain.GetInstance().get_Region();r.GetObjectFromPosition(n*r.get_GridWidth(),o*r.get_GridHeight()).Dispose(),qx.core.Init.getApplication().getMainOverlay()._onClose()}catch(t){console.log(t)}}}}),O.xhr={_load:!1,_xhr:null,_timeout:3e3,start:function(){var t=null;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject('Msxml2.XMLHTTP.6.0')}catch(o){try{t=new ActiveXObject('Msxml2.XMLHTTP.3.0')}catch(t){var n={func:'start',class:'CncEco.xhr'};n.error=t,_(t),beta&&s(t,n)}}return null!==t&&(O.xhr._load=!0,O.xhr._xhr=t,O.xhr._xhr.timeout=O.xhr._timeout,O.xhr._load)},send:function(t,n,o,d,r){try{if(null!==O.xhr._xhr)if(!1!==O.xhr._load&&null!==O.xhr._xhr){if(O.xhr._xhr.open(n,t,!0),null!==o&&'object'==typeof o)for(var l in o)o[l].hasOwnProperty('name')&&o[l].hasOwnProperty('value')&&O.xhr._xhr.setRequestHeader(o[l].name,o[l].value);if(O.xhr._xhr.onload=function(){try{if(4==O.xhr._xhr.readyState)if(200!=O.xhr._xhr.status)t={func:'send',class:'CncEco.xhr'},n='CncEco.xhr._xhr.status !== 200',t.error=n,_(n),beta&&s(n,t);else if('function'==typeof r)r(O.xhr._xhr.responseText);else{var t={func:'send',class:'CncEco.xhr'},n='typeof callback !== function';t.error=n,_(n),beta&&s(n,t)}}catch(n){t={func:'send CncEco.xhr._xhr.onreadystatechange',class:'CncEco.xhr'},t.error=n,_(n),beta&&s(n,t)}},O.xhr._xhr.ontimeout=function(){_('ontimeout'),beta&&s('ontimeout',{func:'CncEco.xhr._xhr.onerror',class:'CncEco.xhr',error:'ontimeout'})},null===d)O.xhr._xhr.send(null);else if('stringify'==JSON.isjson(d)&&!0===Array.isarray(d)||!0===Object.isobj(d)&&'stringify'==JSON.isjson(d))O.xhr._xhr.send(JSON.stringify(d));else{var c={func:'send',class:'CncEco.xhr',error:'Array.isarray(data) && JSON.isjson(data) === \'stringify\' || Object.isabj(data) JSON.isjson(data) === \'stringify\''};_('Array.isarray(data) && JSON.isjson(data) === \'stringify\' || Object.isabj(data) JSON.isjson(data) === \'stringify\''),beta&&s('Array.isarray(data) && JSON.isjson(data) === \'stringify\' || Object.isabj(data) JSON.isjson(data) === \'stringify\'',c)}}else alert('Ihr Browser unterstuetzt kein Ajax!')}catch(t){c={func:'send CncEco.xhr._xhr.onreadystatechange',class:'CncEco.xhr'},c.error=t,_(t),beta&&s(t,c)}}},O.xhr=O.xhr,O.xhr.start=O.xhr.start,O.xhr.name='CncEco.xhr',window.CncEco=O,!0}function n(t){var n,o=[];for(n in t)if('object'==typeof t[n]&&t[n])for(var r in t[n])if(376877<=PerforceChangelist){if('object'==typeof t[n][r]&&t[n][r]&&'d'in t[n][r]){var s=t[n][r].d;if('object'==typeof s&&s)for(var l in s)'object'==typeof s[l]&&s[l]&&'get_CurrentLevel'in s[l]&&o.push(s)}}else if('object'==typeof t[n][r]&&t[n][r]&&'l'in t[n][r]&&(s=t[n][r].l,'object'==typeof s&&s))for(l in s)'object'==typeof s[l]&&s[l]&&'get_CurrentLevel'in s[l]&&o.push(s);return o}function o(t,o,r){_('CNCOpt Link loaded');var s={selected_base:null,keymap:{GDI_Accumulator:'a',GDI_Refinery:'r',"GDI_Trade Center":'u',GDI_Silo:'s',"GDI_Power Plant":'p',"GDI_Construction Yard":'y',GDI_Airport:'d',GDI_Barracks:'b',GDI_Factory:'f',"GDI_Defense HQ":'q',"GDI_Defense Facility":'w',"GDI_Command Center":'e',GDI_Support_Art:'z',GDI_Support_Air:'x',GDI_Support_Ion:'i',FOR_Silo:'s',FOR_Refinery:'r',"FOR_Tiberium Booster":'b',"FOR_Crystal Booster":'v',"FOR_Trade Center":'u',"FOR_Defense Facility":'w',"FOR_Construction Yard":'y',FOR_Harvester_Tiberium:'h',"FOR_Defense HQ":'q',FOR_Harvester_Crystal:'n',NOD_Refinery:'r',"NOD_Power Plant":'p',NOD_Harvester:'h',"NOD_Construction Yard":'y',NOD_Airport:'d',"NOD_Trade Center":'u',"NOD_Defense HQ":'q',NOD_Barracks:'b',NOD_Silo:'s',NOD_Factory:'f',NOD_Harvester_Crystal:'n',"NOD_Command Post":'e',NOD_Support_Art:'z',NOD_Support_Ion:'i',NOD_Accumulator:'a',NOD_Support_Air:'x',"NOD_Defense Facility":'w',GDI_Wall:'w',GDI_Cannon:'c',"GDI_Antitank Barrier":'t',GDI_Barbwire:'b',GDI_Turret:'m',GDI_Flak:'f',"GDI_Art Inf":'r',"GDI_Art Air":'e',"GDI_Art Tank":'a',"GDI_Def_APC Guardian":'g',"GDI_Def_Missile Squad":'q',GDI_Def_Pitbull:'p',GDI_Def_Predator:'d',GDI_Def_Sniper:'s',"GDI_Def_Zone Trooper":'z',"NOD_Def_Antitank Barrier":'t',"NOD_Def_Art Air":'e',"NOD_Def_Art Inf":'r',"NOD_Def_Art Tank":'a',"NOD_Def_Attack Bike":'p',NOD_Def_Barbwire:'b',"NOD_Def_Black Hand":'z',NOD_Def_Cannon:'c',NOD_Def_Confessor:'s',NOD_Def_Flak:'f',"NOD_Def_MG Nest":'m',"NOD_Def_Militant Rocket Soldiers":'q',NOD_Def_Reckoner:'g',"NOD_Def_Scorpion Tank":'d',NOD_Def_Wall:'w',FOR_Wall:'w',FOR_Barbwire_VS_Inf:'b',FOR_Barrier_VS_Veh:'t',FOR_Inf_VS_Inf:'g',FOR_Inf_VS_Veh:'r',FOR_Inf_VS_Air:'q',FOR_Sniper:'n',FOR_Mammoth:'y',FOR_Veh_VS_Inf:'o',FOR_Veh_VS_Veh:'s',FOR_Veh_VS_Air:'u',FOR_Turret_VS_Inf:'m',FOR_Turret_VS_Inf_ranged:'a',FOR_Turret_VS_Veh:'v',FOR_Turret_VS_Veh_ranged:'d',FOR_Turret_VS_Air:'f',FOR_Turret_VS_Air_ranged:'e',"GDI_APC Guardian":'g',GDI_Commando:'c',GDI_Firehawk:'f',GDI_Juggernaut:'j',GDI_Kodiak:'k',GDI_Mammoth:'m',"GDI_Missile Squad":'q',GDI_Orca:'o',GDI_Paladin:'a',GDI_Pitbull:'p',GDI_Predator:'d',GDI_Riflemen:'r',"GDI_Sniper Team":'s',"GDI_Zone Trooper":'z',"NOD_Attack Bike":'b',NOD_Avatar:'a',"NOD_Black Hand":'z',NOD_Cobra:'r',NOD_Commando:'c',NOD_Confessor:'s',"NOD_Militant Rocket Soldiers":'q',NOD_Militants:'m',NOD_Reckoner:'k',NOD_Salamander:'l',"NOD_Scorpion Tank":'o',"NOD_Specter Artilery":'p',NOD_Venom:'v',NOD_Vertigo:'t',"<last>":'.'},make_sharelink:function(){try{var d=s.selected_base,c=ClientLib.Data.MainData.GetInstance().get_Cities().GetCity(d),h=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentOwnCity(),I=ClientLib.Data.MainData.GetInstance().get_Alliance(),P=ClientLib.Data.MainData.GetInstance().get_Server();switch(tbase=d,tcity=c,scity=h,d='http://cncopt.com/?map=',d+='3|',c.get_CityFaction()){case 1:d+='G|';break;case 2:d+='N|';break;case 3:case 4:case 5:case 6:d+='F|';break;default:_('cncopt: Unknown faction: '+c.get_CityFaction()),d+='E|';}switch(h.get_CityFaction()){case 1:d+='G|';break;case 2:d+='N|';break;case 3:case 4:case 5:case 6:d+='F|';break;default:_('cncopt: Unknown faction: '+h.get_CityFaction()),d+='E|';}for(d+=c.get_Name()+'|',defense_units=[],h=0;20>h;++h){for(var S=[],O=0;9>O;++O)S.push(null);defense_units.push(S)}a:{for(var T=n(c),u=0;u<T.length;++u)for(var M in T[u])if(T[u][M].get_UnitGameData_Obj().n in g){var x=T[u];break a}x=[]}if(376877<=PerforceChangelist)for(h in x){var R=x[h];defense_units[R.get_CoordX()][R.get_CoordY()+8]=R}else for(h=0;h<x.length;++h)R=x[h],defense_units[R.get_CoordX()][R.get_CoordY()+8]=R;for(offense_units=[],h=0;20>h;++h){for(S=[],O=0;9>O;++O)S.push(null);offense_units.push(S)}a:{var L=n(c);for(S=0;S<L.length;++S)for(var A in L[S])if(L[S][A].get_UnitGameData_Obj().n in b){var D=L[S];break a}D=[]}if(376877<=PerforceChangelist)for(h in D)R=D[h],offense_units[R.get_CoordX()][R.get_CoordY()+16]=R;else for(h=0;h<D.length;++h)R=D[h],offense_units[R.get_CoordX()][R.get_CoordY()+16]=R;a:{for(var N in c)if('object'==typeof c[N]&&c[N]&&0 in c[N]&&8 in c[N]&&'object'==typeof c[N][0]&&c[N][0]&&c[N][0]&&0 in c[N][0]&&15 in c[N][0]&&'object'==typeof c[N][0][0]&&c[N][0][0]&&'BuildingIndex'in c[N][0][0]){var t=c[N];break a}t=null}a:{var W,V=c.get_CityBuildingsData();for(W in V)if(376877<=PerforceChangelist){if('object'==typeof V[W]&&V[W]&&'d'in V[W]&&'c'in V[W]&&0<V[W].c){var v=V[W].d;break a}}else if('object'==typeof V[W]&&V[W]&&'l'in V[W]){v=V[W].l;break a}v=void 0}for(h=0;20>h;++h)for(row=[],O=0;9>O;++O){var j=16<h?null:t[O][h];R=0,D=null,j&&0<=j.BuildingIndex&&(D=v[j.BuildingIndex],R=D.get_CurrentLevel());var E=defense_units[O][h];E&&(R=E.get_CurrentLevel());var F=offense_units[O][h];switch(F&&(R=F.get_CurrentLevel()),1<R&&(d+=R),16<h?0:c.GetResourceType(O,h)){case 0:if(D){var G=D.get_MdbBuildingId();GAMEDATA.Tech[G].n in s.keymap?d+=s.keymap[GAMEDATA.Tech[G].n]:(_('cncopt [5]: Unhandled building: '+G,D),d+='.')}else E?E.get_UnitGameData_Obj().n in s.keymap?d+=s.keymap[E.get_UnitGameData_Obj().n]:(_('cncopt [5]: Unhandled unit: '+E.get_UnitGameData_Obj().n),d+='.'):F?F.get_UnitGameData_Obj().n in s.keymap?d+=s.keymap[F.get_UnitGameData_Obj().n]:(_('cncopt [5]: Unhandled unit: '+F.get_UnitGameData_Obj().n),d+='.'):d+='.';break;case 1:d=0>j.BuildingIndex?d+'c':d+'n';break;case 2:d=0>j.BuildingIndex?d+'t':d+'h';break;case 4:d+='j';break;case 5:d+='h';break;case 6:d+='l';break;case 7:d+='k';break;default:_('cncopt [4]: Unhandled resource type: '+c.GetResourceType(O,h)),d+='.';}}return I&&scity.get_AllianceId()==tcity.get_AllianceId()&&(d+='|'+I.get_POITiberiumBonus(),d+='|'+I.get_POICrystalBonus(),d+='|'+I.get_POIPowerBonus(),d+='|'+I.get_POIInfantryBonus(),d+='|'+I.get_POIVehicleBonus(),d+='|'+I.get_POIAirBonus(),d+='|'+I.get_POIDefenseBonus()),1.2!==P.get_TechLevelUpgradeFactorBonusAmount()&&(d+='|newEconomy'),r.setFormField('opt'+o,d),d}catch(t){_('cncopt [1]: ',t)}}};s.selected_base=t,s.make_sharelink()}function r(t,n){CncEcomain.getInstance().remoteRequest('update',n)}function s(t,n){var o={};o.func=n.func,o['class']=n['class'],o.message=t.message,o.error=t.stack,MainData=ClientLib.Data.MainData.GetInstance(),P=MainData.get_Player(),o.playerName=P.get_Name(),o.accountId=P.get_AccountId(),server=MainData.get_Server(),o.worldId=server.get_WorldId(),o.clientinfo=l();var r=null;if(console.log('____________________________Mest5-errorreport->send______________________________________'),console.log(o),console.log('_________________________________________________________________________________________'),window.XMLHttpRequest)r=new XMLHttpRequest;else if(window.ActiveXObject)try{r=new ActiveXObject('Msxml2.XMLHTTP.6.0')}catch(t){try{r=new ActiveXObject('Msxml2.XMLHTTP.3.0')}catch(t){console.log(t)}}null!==r&&r.open('POST','https://www.member-stats.de/playerinfo.php?i=error',!0),r.onreadystatechange=function(){4==this.readyState&&(200==this.status?console.log(t):console.log(this.statusText))},r.send(JSON.stringify(o))}function l(){var t,o=navigator.userAgent.toLowerCase(),s=function(t){return t.test(o)},l=s(/opera/),c=s(/chrome/),_=s(/webkit/),f=!c&&s(/safari/);f&&s(/applewebkit\/4/),f&&s(/version\/3/),f&&s(/version\/4/);var y=!l&&s(/msie/),g=y&&s(/msie 7/),b=y&&s(/msie 8/),C=y&&!g&&!b,I=!_&&s(/gecko/),u=I&&s(/rv:1\.8/),P=I&&s(/rv:1\.9/),x=s(/windows|win32/),S=s(/macintosh|mac os x/);s(/adobeair/);var m=s(/linux/);/^https/i.test(window.location.protocol);var A='',v=t=s='',o=navigator.userAgent.toLowerCase(),s=function(t){return t.test(o)};return x?(v='Windows',s(/windows nt/)&&(v=o.indexOf('windows nt'),x=o.indexOf(';',v),v=o.substring(v,x))):v=S?'Mac':m?'Linux':'Other',y?(A=s='IE',u=o.indexOf('msie')+5,t=o.indexOf(';',u),t=o.substring(u,t),A=C?'IE6':g?'IE7':b?'IE8':'IE'):I?(s=(g=s(/firefox/))?'Firefox':'Others',A=u?'Gecko2':P?'Gecko3':'Gecko',g&&(u=o.indexOf('firefox')+8,t=o.indexOf(' ',u),-1==t&&(t=o.length),t=o.substring(u,t))):c?(s='Chrome',A=_?'Web Kit':'Other',u=o.indexOf('chrome')+7,t=o.indexOf(' ',u),t=o.substring(u,t)):s=l?'Opera':f?'Safari':'',g={},g.javascript=A,g.browserType=s,g.browserVersion=t,g.osName=v,g}function c(){try{if('undefined'!=typeof qx){var n=qx.core.Init.getApplication(),o=qx.core.Init.getApplication().getMenuBar();n&&o?(P=ClientLib.Data.MainData.GetInstance().get_Player(),0===P.id?window.setTimeout(c,1e3):(t(),window.CncEcomain.getInstance().initialize(),window.CncEcoScanner.getInstance().initialize(),window.CncEcostorage.getInstance().initialize(),window.CncEcoxhr.getInstance().initialize(),CncEcoHIDE.window.Window.getInstance().initialize(),window.CncEco.xhr.start())):window.setTimeout(c,1e3)}else window.setTimeout(c,1e3)}catch(t){_(t),window.setTimeout(c,1e3)}}function _(t){t='[CncEco] '+t,'undefined'==typeof console?window.opera?opera.postError(t):GM_log(t):console.log(t)}var P=0,u=0,p=null,h=null,d=null,m=null,S=null,f=0,y=0,g={GDI_Wall:'w',GDI_Cannon:'c',"GDI_Antitank Barrier":'t',GDI_Barbwire:'b',GDI_Turret:'m',GDI_Flak:'f',"GDI_Art Inf":'r',"GDI_Art Air":'e',"GDI_Art Tank":'a',"GDI_Def_APC Guardian":'g',"GDI_Def_Missile Squad":'q',GDI_Def_Pitbull:'p',GDI_Def_Predator:'d',GDI_Def_Sniper:'s',"GDI_Def_Zone Trooper":'z',"NOD_Def_Antitank Barrier":'t',"NOD_Def_Art Air":'e',"NOD_Def_Art Inf":'r',"NOD_Def_Art Tank":'a',"NOD_Def_Attack Bike":'p',NOD_Def_Barbwire:'b',"NOD_Def_Black Hand":'z',NOD_Def_Cannon:'c',NOD_Def_Confessor:'s',NOD_Def_Flak:'f',"NOD_Def_MG Nest":'m',"NOD_Def_Militant Rocket Soldiers":'q',NOD_Def_Reckoner:'g',"NOD_Def_Scorpion Tank":'d',NOD_Def_Wall:'w',FOR_Wall:'w',FOR_Barbwire_VS_Inf:'b',FOR_Barrier_VS_Veh:'t',FOR_Inf_VS_Inf:'g',FOR_Inf_VS_Veh:'r',FOR_Inf_VS_Air:'q',FOR_Sniper:'n',FOR_Mammoth:'y',FOR_Veh_VS_Inf:'o',FOR_Veh_VS_Veh:'s',FOR_Veh_VS_Air:'u',FOR_Turret_VS_Inf:'m',FOR_Turret_VS_Inf_ranged:'a',FOR_Turret_VS_Veh:'v',FOR_Turret_VS_Veh_ranged:'d',FOR_Turret_VS_Air:'f',FOR_Turret_VS_Air_ranged:'e',"":''},b={"GDI_APC Guardian":'g',GDI_Commando:'c',GDI_Firehawk:'f',GDI_Juggernaut:'j',GDI_Kodiak:'k',GDI_Mammoth:'m',"GDI_Missile Squad":'q',GDI_Orca:'o',GDI_Paladin:'a',GDI_Pitbull:'p',GDI_Predator:'d',GDI_Riflemen:'r',"GDI_Sniper Team":'s',"GDI_Zone Trooper":'z',"NOD_Attack Bike":'b',NOD_Avatar:'a',"NOD_Black Hand":'z',NOD_Cobra:'r',NOD_Commando:'c',NOD_Confessor:'s',"NOD_Militant Rocket Soldiers":'q',NOD_Militants:'m',NOD_Reckoner:'k',NOD_Salamander:'l',"NOD_Scorpion Tank":'o',"NOD_Specter Artilery":'p',NOD_Venom:'v',NOD_Vertigo:'t',"":''};/commandandconquer\.com/i.test(document.domain)&&window.setTimeout(c,1e3)}.toString();t.innerHTML='('+n+')();',t.type='text/javascript',/commandandconquer\.com/i.test(document.domain)&&document.getElementsByTagName('head')[0].appendChild(t)})();