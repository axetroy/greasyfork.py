// ==UserScript==
// @name         Tagless
// @namespace    http://tampermonkey.net/
// @version      0.33
// @description  Tagless shows on Anilist.co
// @author       hoh
// @match        https://anilist.co/*
// @grant        none
// ==/UserScript==
(function(){

/*
function lsTest(){//localStorage is great for not having to fetch the api data every time
    var test = "test";
    try{
        localStorage.setItem(test,test);
        localStorage.removeItem(test);
        return true;
    }catch(e) {
        return false;
    }
}

if(lsTest() === true){
    var localStorageAvailable = true;
	var taglessUsed = localStorage.getItem("taglessUsed");
	if(taglessUsed === null){
		taglessUsed = {
			keys : []
		};
	}
	else{
		taglessUsed = JSON.parse(taglessUsed);
	};
	localStorage.setItem("taglessUsed",JSON.stringify(taglessUsed));
}
else{
    var localStorageAvailable = false;
};
*/

var handleResponse = function(response){
	return response.json().then(function(json){
		return response.ok ? json : Promise.reject(json);
	});
};
var handleError = function(error){
	//alert("Error, check console"); //fixme
	console.error(error);
};
var url = 'https://graphql.anilist.co';//Current Anilist API location

var generalAPIcall = function(query,variables,callback){
	var handleData = function(data){
		callback(data);
	};
	var options = {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json',
			'Accept': 'application/json',
		},
		body: JSON.stringify({
			query: query,
			variables: variables
		})
	};
	fetch(url,options).then(handleResponse).then(handleData).catch(handleError);
};

var pending = 0;

var cache = [
20871,20695,341,100518,17949,4760,3363,21209,6489,5041,20682,6896,963,103631,20721,17901,17743,14951,21721,12677,3298,3247,97951,11033,17345,97936,3389,21790,3086,15313,101359,8599,21115,1335,98338,106509,1830,3174,1682,11755,98999,98662,20674,12637,910,100619,7598,8918,10260,6399,10532,1219,2163,20715,15951,98860,1732,651,15043,7875,10477,2512,1103,21276,98504,7782,2603,5333,704,17813,11879,99528,1214,20578,13561,2683,20823,15325,21876,281,20557,8078,100227,1369,98663,2123,12449,98703,100729,3166,5020,19165,8230,4886,21013,6330,101909,884,10370,14875,6344,3576,12447,21449,97915,4798,7016,98452,98862,21041,17849,15045,9023,8668,6443,20891,102629,20870,11507,14663,609,5538,4052,2237,18413,10258,4189,10445,21743,20883,20750,454,11487,21632,100502,2597,16363,98525,8619,21257,14317,818,20267,4460,1631,21263,3840,20748,3268,758,21231,99281,106286,2513,1368,17395,98847,21317,97995,10870,6231,4657,10531,254,20469,15673,6148,426,21205,1994,7474,99164,98206,99196,20673,1941,99678,99636,1085,1750,673,99055,11715,20504,98863,13375,98715,2852,1783,5194,1773,766,98546,97856,10691,13239,21119,17815,99152,98581,631,97745,294,21405,21080,932,99153,103276,98106,21030,20892,13173,7066,3939,2867,15847,12433,10799,4069,20902,98875,10947,4012,11065,98621,337,1573,8291,2866,20538,255,98004,2965,13253,13057,6705,706,101092,14333,10390,1156,7113,2174,20999,559,16936,21634,7744,15219,14583,6152,6169,10948,21463,4502,21633,98622,10849,97607,1988,18691,103277,100269,21251,8331,102499,10098,7304,1187,21705,17791,16678,99548,17811,2523,19573,5045,3771,3618,102946,21168,20576,20562,5291,3266,6958,5959,56,102508,103275,21245,2267,4600,8062,103237,15453,8022,1841,99707,4549,10089,7774,16381,15781,14957,9435,6219,98220,20836,1679,20522,835,21475,102065,13137,3027,1105,708,1724,19727,6032,2617,8507,21086,12055,6198,1749,99527,19845,5158,17551,20909,101216,102001,102033,10695,2141,1996,101597,8709,8648,13231,3944,98655,6628,2411,7759,5351,106896,21829,104200,4312,99083,18781,10457,7261,98784,17913,9924,101919,6953,99197,671,20377,1856,102651,100768,101339,21656,20948,475,21299,19631,13691,13251,104712,21889,21618,6986,1235,15541,21402,20391,301,100718,99608,99568,10679,5172,12121,2352,1991,97966,2760,101817,18653,1660,7540,21371,1618,1902,102573,15785,10050,4166,3889,9311,20776,2433,15393,10301,1325,102717,16189,21491,3506,3493,102973,102734,21594,7108,6692,1648,21017,7266,1600,11699,2212,14675,2194,7453,3234,2868,2858,102063,5027,87499,16690,8754,6690,6999,6713,19287,102453,101227,20925,100980,14685,21466,11807,9673,6122,98577,98517,19521,4763,102605,21419,6130,14993,102600,2470,104458,2619,7305,695,87527,100522,18419,15979,1751,21783,1128,18531,21148,9167,965,5875,5016,21109,7781,102979,2016,21374,6985,18231,105018,4590,8635,102609,100769,2217,7060,4173,6276,98615,2967,1633,102507,319,9487,13669,7668,4004,102618,3406,1263,87481,6226,2590,101168,21549,2245,19185,10361,20580,5983,21124,7265,12699,5819,16233,101635,10545,3058,7377,1823,11855,3115,2817,100717,2869,2531,999,103717,10392,102716,101744,21130,5651,102470,1683,12957,4591,2349,100912,13053,7178,101349,102503,1104,17727,9442,605,16738,102599,4712,1081,102621,21480,1193,100931,98045,10421,6950,19081,10405,103638,102581,99348,13223,7712,5743,21767,104071,10666,9968,4398,21223,6809,757,309,101499,10406,556,12935,9798,20939,503,99530,3820,2445,99718,21533,21169,10825,7718,4607,97955,102441,101916,13281,102401,3286,2165,1189,101372,6604,100981,13019,9328,6743,16059,10553,107418,21102,6607,1111,21195,10950,1112,964,4804,9309,6533,3680,4475,2319,20822,748,21805,17068,2406,7268,7877,5622,1388,101610,6666,21766,10570,7583,360,9778,6137,103887,21526,10819,3390,98760,5288,3707,101912,21863,13185,5539,5153,2793,98515,9545,104979,3307,21143,11031,6891,5569,3636,2505,2447,1039,15279,8423,2387,1466,102859,102006,6531,5037,2526,102572,21488,2861,2357,363,18205,4461,98518,21528,20903,10824,3727,106239,97978,16906,8713,7612,3906,1926,4467,21843,2506,98252,5214,3821,2145,8287,5051,1271,20676,10822,3772,2620,13559,4091,9009,8234,1456,2436,2394,98307,97610,5785,104411,102504,3916,10764,913,105655,98761,21411,3684,2249,102077,17897,9494,8297,6686,3186,2945,1752,12659,1857,8289,707,21159,21149,753,21580,8651,3896,2371,20743,10101,4476,100893,12955,11543,2307,104378,101926,98094,21752,13563,3422,3003,6220,97947,21561,11177,832,102505,21203,16415,9718,8935,102603,98079,9595,5321,3110,2315,21393,15769,15159,4730,2068,102827,21278,2676,2998,2309,7024,1024,11735,5324,101971,8312,3250,21173,19635,21869,5147,102825,102714,21070,20825,1071,15505,13379,3308,2185,545,102096,97967,21373,1582,102929,102598,98864,98846,1955,101091,5054,2521,1898,106240,21722,3062,2827,102607,9895,1756,1684,5308,3578,1129,21396,1895,102075,4849,2228,1406,102602,99208,11511,16476,11469,6189,4494,2895,2507,21605,7176,1755,994,9732,9100,6235,3818,1819,101084,11815,8936,4213,2991,2134,1113,101917,102483,19633,1031,98527,19523,4808,3193,2437,625,21551,20707,11523,7811,2370,2009,1671,104721,983,3138,14935,4966,2693,1586,1337,21142,98289,105934,100340,21532,4936,3581,21160,8111,362,21105,16644,9035,2359,21060,4689,3622,3008,675,2960,2153,100071,21141,17010,106287,103119,9777,7230,1529,3729,3385,1791,4356,2412,2209,2063,9434,2715,1766,13643,9006,7611,9561,6076,2862,1386,10420,7363,5686,4419,20699,9846,3112,2420,1630,722,9312,8294,5802,823,21548,20894,11749,5813,2353,1228,19187,16091,2312,104211,10938,5211,4617,3919,87482,1788,2958,2917,21826,21397,14659,13287,102034,99710,87483,21229,12661,2484,100176,13955,7030,848,99950,10688,9990,5644,2859,2462,8689,9566,9327,8290,5868,5814,2533,1677,1665,107294,13153,10723,8925,8486,3560,101966,15423,6909,3842,2910,2671,99883,6061,5812,2395,2191,2049,106206,21846,15095,10104,3751,2667,2064,102606,99643,8952,3638,101115,16964,2377,107067,3802,1613,4202,3649,2423,102437,21537,1884,12025,4854,2528,213,100148,20911,18831,1753,99856,15015,8132,3736,2540,2207,1275,12865,7582,6992,5755,5742,4070,3039,21530,13917,102823,101078,8701,1385,101819,99216,98095,17659,7415,5210,2351,1779,107138,10882,6422,5213,4127,2168,810,102337,1854,102482,102305,2944,100570,8134,2934,2410,99893,6932,2659,2102,1820,7809,6878,6131,3171,2656,21211,9361,7022,2957,2863,2360,2379,1627,98472,98090,6116,4492,2532,102429,12919,7578,5043,3793,2716,102601,102452,6245,5869,216,100871,19447,15093,10043,5200,4387,5904,3917,676,6840,6390,5238,3557,3427,2003,1782,1176,8333,7290,6837,2660,1770,611,10354,7659,217,102009,20535,7031,5496,5036,3976,3911,3454,2672,2072,102826,102755,20675,101976,99817,12133,6509,4601,2935,1741,3439,2823,97593,21117,20890,19519,10286,9211,6413,3254,1332,1075,1038,21543,8235,4799,4533,3809,2678,2327,1885,102582,100358,19233,9091,4493,3329,1947,215,4451,3858,2430,796,7243,6374,5265,2065,102525,7573,5096,1757,1283,102652,98451,14047,12683,3107,13495,10859,3538,3152,2140,1754,97916,10823,10429,6721,6833,4823,4396,3849,2826,21036,7026,6834,6182,4058,3452,3108,106893,102723,102485,8632,2821,2482,2431,2266,2094,2055,1708,7900,6667,5330,5296,1828,105928,102003,98207,10463,5880,2959,99230,97756,11729,6975,4688,4084,592,105245,98791,21811,5299,13441,4723,4471,3952,3490,3382,2588,1383,101911,101278,5838,3981,3582,3532,2384,2059,1528,17141,6851,3795,3526,2348,98133,7455,6947,5568,3915,3136,6355,4378,3847,3635,2658,2378,2260,21395,21254,7528,725,7027,6935,5811,2439,17293,5136,5070,4383,2541,2070,102657,102360,98972,9254,7032,5870,2195,2189,101789,12561,6823,4700,4418,4364,3566,105907,102620,17076,1620,12141,8664,7029,7004,4946,2380,2021,6831,4086,101914,99217,19217,17693,15993,11795,5872,2864,2674,2328,19235,10256,9976,9662,9486,6183,6038,3529,3056,2535,2469,104959,102064,20563,14943,9318,7775,7451,7244,6670,3910,3379,2652,2630,1595,7192,4608,4000,3843,3644,2839,2574,103221,102363,12499,6830,1404,102756,3543,3393,3313,2444,102575,102299,18133,10207,6829,5017,3705,3527,13793,10424,6861,5411,4357,3442,3064,2833,2376,1758,102464,10941,3833,2434,1513,102389,15455,9855,8144,7156,4154,2915,2901,102623,5167,4099,3945,3463,3046,2892,1740,102828,17969,8812,8216,2740,1933,106895,12135,6899,6375,6328,5620,11221,6181,5618,2329,17733,6856,4537,3968,3960,2613,2310,1763,102554,8964,8628,98772,11579,5925,5589,3334,3065,2095,104396,99582,19231,7843,4439,2066,104284,103334,100072,8855,8162,7569,7333,4252,4009,2634,1900,2007,106506,105119,13789,9423,3980,3370,103130,99843,99788,21352,20858,6000,4044,3920,3883,3147,2316,2256,220,107342,104156,103023,102617,21628,18109,7020,6846,6271,4567,4286,2894,2625,104160,98136,19237,9502,9356,8663,8275,7571,6828,5733,5101,4208,3874,3109,4961,4480,3826,3640,3580,104371,98421,9667,7307,4868,3953,2681,2614,107346,103022,20937,17245,10584,9851,6484,5266,3587,828,107213,102387,100720,6978,5645,4833,3676,3648,3586,2467,102658,102611,7482,6937,6847,5828,5576,4463,3671,3113,3066,2721,2440,6777,6303,5871,5133,3884,3531,3063,2837,104557,103393,101913,21877,18375,16912,7445,5143,4603,3810,2736,2069,103394,102712,101430,100297,98785,7488,6571,6096,4487,3377,19125,11445,5891,5689,5408,4742,4479,3757,2326,103417,102159,18603,9801,8409,6622,5398,5006,4867,4717,4490,5117,4917,3540,3098,2338,9239,7294,6684,4563,3950,3639,2646,2232,1993,1402,13233,13089,8710,5203,5191,4774,4697,3498,3432,2633,106541,106499,10443,8079,7617,6855,4934,4729,3932,102801,102076,100657,7122,6827,5874,5403,4929,4855,4840,4074,3551,3378,3082,2650,103395,102763,102433,101094,97952,11269,6434,4856,2936,2578,102685,100290,97595,20788,19239,8963,8706,105973,102576,9650,8178,6695,98776,13795,12351,11541,10674,8960,5649,4395,4161,3267,2831,2769,2627,2239,99644,15533,8890,7532,6268,5936,4524,4379,2340,102661,87518,20888,20484,9013,5609,5235,4842,3596,3519,1833,103924,97958,9495,5311,2794,2702,2631,107263,106571,103370,103015,102659,102502,16371,5629,5395,5289,4848,4834,4692,4088,3947,3428,102998,102625,102463,98474,98051,17403,10751,8928,5197,4638,3695,3564,2443,1849,1154,104092,99001,19481,15749,9824,8993,8722,7450,5878,4675,3942,3895,3806,3094,2626,2501,2314,107625,106674,104367,101342,99645,98969,98751,17785,13421,13083,11141,10436,6472,3460,2956,2632,2074,107490,102399,97963,3631,3093,2551,310,104029,18457,17325,9325,3536,3384,2806,2464,2368,1975,18425,10718,10632,10373,8598,7530,7496,6107,4211,2373,2208,107622,107348,97956,20957,102362,15795,7021,4489,103396,101555,99085,11767,6939,6848,5353,4119,3539,107264,106606,99715,98383,12723,6842,4935,4541,3583,1784,107350,97906,16247,15527,12521,10904,10742,9826,7862,6672,6468,5990,3969,3565,3383,105616,103397,100324,98638,17237,10755,8553,7982,7296,6075,5572,4802,4800,4731,4097,3361,2645,2421,102388,16251,13087,13085,9392,9043,8431,5933,5920,4821,4509,4459,4083,10319,6078,104330,103140,102673,102095,101985,9887,6452,5640,5237,4933,4818,3104,105962,104003,17965,14743,10585,8011,7876,5900,5545,5263,4400,2737,2628,10586,7446,5646,5605,5449,4498,4488,3951,3824,3628,2629,1545,103398,102682,101279,10005,9829,9365,8765,8661,7139,4604,4098,4085,3982,3902,3562,3380,2990,2874,2455,102439,4178,103410,103316,102759,102526,102364,102302,101290,17295,10627,7501,6907,5934,5396,4554,3151,102010,98137,17387,16373,9445,9409,10763,9991,8669,7106,6025,5159,4693,3832,2687,102359,21761,20885,17151,10194,8446,4575,2568,103948,103450,101878,14039,12769,10132,8604,8496,6270,4266,3912,3556,2190,103050,102683,100289,100050,97594,10813,10459,6310,4820,4561,3194,102168,4841,107704,104292,102709,101180,10847,9340,8631,8041,6674,6087,5590,5472,3252,2240,1776,491,104739,103886,103392,102610,21572,21344,9978,8774,6903,5544,5129,4157,4132,4497,3690,102707,102557,102444,102058,101904,100360,21456,8563,8130,7245,6625,5608,5475,4126,4073,2226,2086,107740,106159,103752,103692,102715,9284,3643,307,104027,103753,102053,101877,101697,18365,18155,14471,8150,8140,7504,5249,4941,3983,3890,3550,3396,3129,2941,1499,1355,99845,18845,18463,9385,7779,7512,8731,8723,5558,3876,3817,106858,105663,103350,102687,102574,19209,13407,13195,10540,8919,5561,5375,4819,3542,3020,2339,100790,99884,98208,21680,21052,19337,11268,5665,5190,4616,4556,4013,3724,3497,1552,107176,106568,103374,102662,102157,101579,18561,16377,13857,9691,9391,8158,8157,7729,6970,5071,10407,7939,5917,5570,4452,4054,3530,107671,102443,102390,100359,21884,20441,17159,16702,14947,9499,7164,5566,5548,5022,4644,3567,102391,101354,101431,12139,10541,9519,9317,8285,7461,5612,5587,5547,4557,3808,3355,106921,104631,102762,102633,102438,102060,101178,100910,98965,16259,16131,8154,104925,103138,102770,102678,102648,102619,102616,102555,102506,102403,102392,21353,20145,17753,16393,15399,14207,13103,12341,10648,9341,8958,8697,8139,8065,7601,7529,9257,7423,5664,5610,4544,105964,102694,102655,14023,13543,9882,8707,5614,4807,4332,2830,2503,103314,103009,102666,21844,20857,17092,11995,10409,6989,6015,7448,7154,6868,5588,3846,103796,102705,102634,102097,101879,98586,18483,14209,13551,12563,9390,8751,8218,6917,5573,5567,5018,102626,102164,104344,104189,102699,17161,13369,10758,10375,9759,8667,7511,6412,6067,5889,5586,5563,5555,5492,5234,5201,4495,3723,1850,1139,103368,103021,102768,102711,102462,101876,97887,13497,11825,10353,8786,7420,7374,7162,5687,4104,107313,104943,104391,104095,104082,103690,102706,102395,101411,19171,17131,12037,9172,8719,8153,8081,7960,7551,7505,6728,5908,5515,103939,103454,102692,102669,102653,102509,102488,102426,102072,98290,21809,21065,13553,10760,9542,8332,7955,6366,6091,4521,107447,104423,104343,103926,103719,103534,103485,103439,103317,102789,102708,102515,12799,12767,9947,8883,8416,7908,7713,3514,2741,104543,102580,102551,102513,102467,101967,98752,17671,16560,12887,12551,9433,8732,8539,8403,8353,8191,19849,19627,13091,9795,9781,9389,8156,7752,5575,5542,5303,106508,106320,104563,104490,104422,103531,103523,102767,102691,102663,99210,87479,14249,13769,13051,10607,106578,105606,104406,103936,103780,103455,103418,103379,103338,102787,102236,102162,102161,102037,87516,20177,19981,19267,18451,10989,10757,10506,10304,9518,6447,6397,5559,5546,5534,3164,107344,104930,104574,104128,103663,103358,102786,102686,102563,102523,102516,102405,102158,101881,100517,16263,15067,14125,13207,13177,12397,10889,10077,9416,9403,9061,8763,8733,8372,8025,7844,6261,5930,5886,5541,6133,5581,5556,5202,4940,105974,104079,103404,102612,102594,20007,19995,17501,17405,16812,11589,10812,10533,9575,9316,8955,8891,8696,8471,8182,7452,6822,6195,5553,5423,4112,3834,9822,9507,8718,8141,7575,7189,5931,5607,5571,5564,4907,4511,2822,107193,107069,106923,103716,103537,102781,102710,102636,102304,101923,101843,98135,18479,16506,15579,15141,12765,10623,7721,8152,7398,5272,5104,107739,107179,107141,103451,103422,102721,102596,101974,98968,98632,20886,19305,17163,16007,14621,9748,8155,7836,6942,5783,5621,5611,5565,5560,5540,4832,4560,2366,106569,106158,6077,107195,105596,104922,104545,104416,104358,104158,103944,103930,103777,103703,103389,103384,102765,102630,102520,102460,102402,102152,101523,98467,97954,19747,14821,14781,13959,13947,12791,20189,11405,11213,9665,9503,9352,9270,8967,8829,8523,7449,6202,5557,5278,4822,4504,4218,3822,3130,106919,106438,105970,104456,104426,104339,103478,102684,102644,101880,18815,13519,11857,11733,11533,9797,9338,7709,7459,6965,5841,5207,105873,104355,103755,103482,103479,103409,103408,103380,103325,103169,102790,102690,102671,102667,102638,102556,102486,102382,21095,20087,20001,5223,3689,3683,3659,105244,104383,104004,103776,103535,103048,102769,102672,102519,102062,13817,10815,10261,8752,8717,8671,8417,7343,4131,107196,104575,104566,104480,104425,104099,104076,5088,4824,4440,107345,107199,104565,103181,103003,102394,99935,98967,21768,19971,18227,14519,8451,8180,7914,7751,5663,5240,2732,107188,106920,104334,103318,101907,102398,102238,100655,21810,20237,19961,18627,17749,17423,16556,16257,14529,12807,12393,9522,9504,8184,6073,5552,5551,3909,2738,102941,102924,102772,102518,102378,102298,102101,102031,98902,20233,20185,20079,19445,17447,16776,16590,16562,16303,13821,13449,12451,11049,10539,10368,10241,9334,8239,7527,16554,16261,15873,12497,11093,10709,10044,9952,9417,8724,8561,8213,8183,7956,7856,7845,6687,5543,2647,107668,107174,104404,104130,103548,103403,103391,103315,14631,12895,12835,12391,12259,11609,10236,9500,9383,8243,7715,7531,6727,3180,107692,106493,104180,104124,104107,103997,103932,103770,103758,103693,103375,103371,103333,102983,102775,102468,102458,99534,98893,98765,98611,21883,21566,20243,102151,102102,101905,20261,20205,20109,20005,20003,19965,19897,19751,19069,18469,18005,17687,16788,16041,13179,12901,12771,11097,10563,10040,9965,9885,9810,13831,13827,13825,13819,13781,10965,10437,9817,8862,8258,104547,104424,104176,104101,104100,104096,103526,103514,103433,103431,102670,102650,3500,3451,2642,107175,106458,104941,104932,103524,103505,103492,103474,103324,102668,102300,102237,102074,101017,98465,97977,21781,17891,16730,16586,16558,16530,13823,13455,11501,10997,10887,10852,9948,9304,8799,7750,7683,4547,2173,107194,106153,104417,104181,104081,103547,103475,103470,103453,103407,103355,103154,102984,102724,102665,102091,19831,16620,16510,18773,12793,12781,10759,10245,10238,10039,9546,9343,9070,8999,8685,5943,3828,2636,107255,106160,104338,104182,103934,103794,103778,7211,5089,3973,105961,104527,104395,104387,104347,104345,104097,104072,103750,103700,103542,103540,103520,103518,103504,103497,103476,103432,103420,103412,103344,103176,102982,102981,102940,102794,102766,102676,102577,102559,102552,102454,102303,102235,98764,98450,103928,103720,103699,103546,103545,103507,103503,103500,103498,103493,103402,103366,103352,103343,103328,103016,103008,102698,102445,102377,102295,101968,101882,101157,98763,21630,20143,19749,19717,18475,17201,8179,7525,6671,4598,4553,3937,2691,105899,105858,104957,104590,104427,104409,104086,103795,103789,103769,103746,103477,103437,103413,103381,103340,103166,102693,102679,102654,102637,102627,102558,102487,102393,102376,102361,9388,9387,8345,7839,6206,4621,3243,2639,107666,106226,104568,104419,104418,104289,103940,103785,103759,103519,103510,103506,103460,103357,103335,103168,102656,102569,102466,102384,102357,102160,102099,21801,20117,20023,19887,19053,16832,6528,6018,5986,5916,3073,2930,107189,104564,104428,104390,104354,104327,104190,103986,103985,103979,103929,103927,103922,103920,103787,103783,103747,103742,103729,103525,103517,103513,103509,103446,103443,103429,103386,103383,103378,103372,102567,102565,102522,102514,102440,102379,102038,100983,98468,20201,19533,18521,17675,17624,17457,17339,16908,16566,16490,13365,12371,11611,10210,9811,9447,9351,8832,19463,17106,16572,16253,11497,10995,10633,8749,8192,8143,7526,7177,4417,2750,107530,107370,107198,106161,104926,104591,104570,104553,104349,104335,3414,106873,106550,106162,104528,104429,104389,104091,104075,103981,103947,103774,103516,103490,103481,103459,103458,103457,103438,103430,103425,103415,103363,103296,102783,102664,102568,102521,102501,102459,101704,100654,20111,19745,19729,19559,19783,17487,17469,16568,16552,12529,11959,11585,9818,9812,9540,9404,8244,7633,7495,5473,103775,103771,103751,103710,103709,103515,103502,103434,103419,103353,103345,102942,102771,102553,102489,102472,102381,102301,102294,20083,20081,20077,18071,17427,15657,12861,12809,11731,11095,9498,8957,104567,104420,104381,104370,104336,104328,103980,103951,103935,103919,103767,103766,103762,103714,103701,103541,103511,103499,103486,103484,103468,103466,103399,103390,103388,103341,103327,103163,103013,103010,102935,102780,102778,102595,102566,102434,102404,20085,18341,18339,103174,103161,103125,103018,102932,102931,102695,102688,102550,102448,102314,101524,20123,19797,18527,12759,11197,10756,9886,8521,8520,8346,106925,106566,105433,105049,16480,13511,9949,3372,107076,104940,104868,104629,104558,104555,104478,104469,104405,104380,104333,104131,103982,103976,103975,103958,103952,103950,103949,103793,103792,103788,103782,103779,103765,103760,103501,103496,103487,103465,103449,103330,102937,102934,102788,102777,102561,102473,102239,99900,19753,17100,16063,15129,13505,13459,12643,11681,10244,9820,9819,8229,107528,107010,106861,104738,104592,104507,104191,104161,104129,104126,104098,104070,103954,103790,103764,103748,103743,103521,103491,103445,103442,103414,103406,103405,103377,103326,103170,103162,102776,102578,102456,102455,102358,102306,102297,102032,13509,9825,7629,5827,107131,106701,104942,104577,104529,104413,104392,104373,104341,104340,103538,103489,103462,103448,103444,103436,103424,103400,103361,103359,103331,103004,102793,102689,102562,102512,102511,102461,102365,102066,107670,107627,107075,106564,106554,105023,104956,104938,104554,104465,104369,104183,104064,104040,103945,103943,103781,103749,103708,103533,103360,103347,103178,103159,104323,104184,104106,104087,103955,103942,103933,103791,103761,103721,103702,103587,103529,103452,103385,103356,103332,103179,103177,102986,102702,102701,102700,102560,102380,102355,102163,102094,102059,98628,10242,107340,107257,106222,104576,104556,104509,104472,104433,104185,104093,104038,103983,102397,102383,102366,102292,102290,101179,107259,107258,107070,106567,106549,106546,106545,104949,104594,104569,104362,104357,104342,104177,104163,104155,104125,104094,103974,103971,103970,103730,103471,103467,103339,103175,103173,103012,103007,103957,103956,103784,103711,103691,103549,103544,103530,103512,103508,103494,103488,103483,103461,103440,103435,103421,103348,102784,102579,102296,9956,107623,107535,107200,106676,106543,105929,104952,104951,104630,104559,104377,104365,104361,104356,104337,104215,104169,104088,104069,103977,103953,103946,103768,103763,103718,103664,103539,103528,103426,103423,103416,103401,103124,103011,102938,102779,102704,102374,99724,107177,107132,106675,106496,106220,106168,104955,104414,104089,104084,103996,103978,103786,103773,103772,103757,103745,103741,106561,106558,106555,106548,106538,105021,104954,104953,104593,104412,104379,104374,104360,104179,104166,103989,103756,103722,103473,103387,103362,103164,103160,102396,102373,107178,106565,106562,106560,106551,106539,105860,105230,104467,104466,104359,104178,104167,104165,103724,102943,102791,102696,102372,13829,107299,106924,106559,106557,106556,104544,104510,104408,104407,104364,104168,103973,103972,103966,103938,103931,103921,103706,103532,103495,103456,103428,103411,103351,103336,102842,102792,102371,102368,5793,107197,107191,107187,106563,5606,5344,2749,1851,103698,103373,103365,102725,102681,97715,19879,17359,15787,15525,12993,12039,9796,9438,8681,5829,5773,5314,5013,4825,4817,4574,102720,102660,102635,102428,102386,103705,103172,103171,102369,105861,104375,104068,103723,103704,103480,103472,102985,102370,107301,107300,107296,102291,107669,107764,105972
];

var style = document.createElement('style');
style.type = 'text/css';

style.innerHTML = `
.tagLess::after{
	content: "no tags";
	color: red;
	border-style: solid;
	border-color: red;
	border-width: 1px;
	padding: 2px;
	border-radius: 2px;
	position: absolute;
	background-color: rgb(31,35,45,0.8);
}
`;

document.getElementsByTagName('head')[0].appendChild(style);

var findUntagged = function(){
	var possible = document.getElementsByTagName("a");
	for(var i=0;i<possible.length;i++){
		if(!possible[i].hasOwnProperty("hohTagTagged")){
			possible[i].hohTagTagged = true;
			if(possible[i].href){
				if(possible[i].href.match(/^(https?:\/\/anilist\.co)?\/anime\/\d+\/?(.*?\/)?$/)){
					var idMatches = /anime\/(\d+)/;
					var ids = idMatches.exec(possible[i].href);
					var idNumber = parseInt(ids[1]);
					if(cache.indexOf(idNumber) != -1){
						possible[i].classList.add("tagLess");
						possible[i].idNumber = idNumber;
					};
				};
			};
		};
	};
	var possibleFalsePositives = document.getElementsByClassName("tagLess");
	for(var i=0;i<possibleFalsePositives.length;i++){
		if(!possibleFalsePositives[i].classList.contains("hohDouble")){
			possibleFalsePositives[i].classList.add("hohDouble");
			possibleFalsePositives[i].classList.add("hohSearch" + possibleFalsePositives[i].idNumber);
			var variables = {
				id: possibleFalsePositives[i].idNumber
			};
			var query = `
query ($id: Int!) {
  Media(id: $id) {
    id
    tags {
      name
    }
  }
}
`;
			var positiveCallback = function(data){
				var targetMedia = document.getElementsByClassName("hohSearch" + data.data.Media.id)[0];
				targetMedia.classList.remove("hohSearch" + data.data.Media.id);
				console.log("possible false positive checked" + data.data.Media.id);
				if(data.data.Media.tags.length != 0){
					targetMedia.classList.remove("tagLess");
					console.log("removed false positive");
					setTimeout(function(){
						var targetMedia = document.getElementsByClassName("hohSearch" + data.data.Media.id);
						for(var j=0;j<targetMedia.length;j++){
							targetMedia[j].classList.remove("tagLess");
							targetMedia[j].classList.remove("hohSearch" + data.data.Media.id);
						};
						},1000
					);
				};
			};
			if(pending != possibleFalsePositives[i].idNumber){
				generalAPIcall(query,variables,positiveCallback);
				pending = possibleFalsePositives[i].idNumber;
			};
			return;
		};
	};
};
setInterval(function(){
	findUntagged();
},1000);
console.log("Tagless 0.33");
})();